<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    {% include "indexShablon_head.html" %}

</head>

<body>

<div id="wrapper">
    {% include "indexShablon.html" %}


    <div id="page-wrapper">
        <div id="page-inner">
            <div class="row">

                <section class="vh-100 gradient-custom-2">

                    <div class="py-5 h-100">
                        <div class="row d-flex justify-content-center align-items-center h-100">
                            <div class="col-md-12 col-xl-10">
                                {#                            start раздел с поиском#}
                                <div class="form-group panel panel-default">

                                    <div class="row">
                                        <div id="page-header">

                                            <div class="search_block">
                                                <form>
                                                    <input type="number" id="number_search" class="search"
                                                           placeholder="Поиск обращения по номеру">
                                                    <input type="submit" onsubmit="event.preventDefault(); return false"
                                                           id="Search" class="submit" value="">
                                                </form>

                                                <table class="table text-white mb-0 user-task-table" id="search_table"
                                                       style="display: none">
                                                    <thead>
                                                    <tr>
                                                        <th scope="col">Номер задачи</th>
                                                        <th scope="col">Связь</th>
                                                        <th scope="col">НАЗВАНИЕ ЗАДАЧИ</th>
                                                        <th scope="col">АВТОР</th>
                                                        <th scope="col">ИСПОЛНИТЕЛИ</th>
                                                        <th scope="col">отдел</th>
                                                        <th scope="col">ДАТА НАЗНАЧЕНИЯ/КОНТРОЛЬНЫЙ СРОК</th>
                                                        <th scope="col">ПРИОРИТЕТ</th>
                                                        <th scope="col">СТАТУС</th>
                                                        <th scope="col">РЕШЕНИЕ</th>
                                                        <th scope="col">КОНТРОЛЬ</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>


                                                    <tr id="unsuccess" colspan="11">
                                                        {#нет такой задачи#}
                                                        <th>
                                                            <span>нет такой задачи</span>
                                                        </th>
                                                    </tr>

                                                    <tr id="success">

                                                        {#НОМЕР ЗАДАЧИ#}
                                                        <th><span id="id" style="font-weight:normal"
                                                                  class="ms-2">123</span>
                                                        </th>
                                                        {#Связь#}
                                                        <th><span id="connection_search" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#НАЗВАНИЕ ЗАДАЧИ#}
                                                        <th><span id="name" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#АВТОР#}
                                                        <th><span id="UserPfofile_create" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#ИСПОЛНИТЕЛИ#}
                                                        <th><span id="UserPfofile_executor" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#отдел#}
                                                        <th><span id="department" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#ДАТА НАЗНАЧЕНИЯ/КОНТРОЛЬНЫЙ СРОК#}
                                                        <th><span id="control_date" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#ПРИОРИТЕТ#}
                                                        <th><span id="priority_search" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#СТАТУС#}
                                                        <th><span id="status_search" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#РЕШЕНИЕ#}
                                                        <th><span id="result_search" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                        </th>
                                                        {#КОНТРОЛЬ#}
                                                        <th><span id="control_search" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                            <button id="control_process">

                                                            </button>
                                                        </th>

                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <script>
                                    console.log(document.getElementsByName("number_search"))

                                    document.getElementById("Search").onclick = async function (event) {
                                        document.getElementById("search_table").style.display = "table-row"
                                        document.getElementById("success").style.display = "none"
                                        document.getElementById("unsuccess").style.display = "none"

                                        event.preventDefault();

                                        console.log("event", event)
                                        res = await fetch("/userprofile/UserTask_Search_id?id=" + document.getElementById("number_search").value, {
                                            method: "GET",
                                            headers: {
                                                Accept: 'application/json',
                                                'Content-Type': 'application/json',
                                                "Authorization": getCookieValue("Authorization")
                                            },
                                            {#body: JSON.stringify({})#}
                                        });

                                        let responseText = JSON.parse(await res.text());
                                        if (res.status == 200) {
                                            window.update_value_user_id_search_value = responseText
                                            update_value_user_id_search(responseText)

                                        } else {
                                            showToast("Ошибка", "error", 5000);

                                        }
                                    }

                                    function update_value_user_id_search(responseText) {
                                        if (responseText.length == 0) {
                                            document.getElementById("unsuccess").style.display = "block"
                                            document.getElementById("success").style.display = "none"


                                        } else {
                                            console.log("----------------")

                                            document.getElementById("unsuccess").style.display = "none"
                                            document.getElementById("success").style.display = "table-row"
                                            document.getElementById("priority_search").innerText = responseText[0].priority
                                            if (responseText[0].result == "") {
                                                document.getElementById("result_search").innerText = "отсутствует значение"

                                            } else {
                                                document.getElementById("result_search").innerText = responseText[0].result

                                            }
                                            document.getElementById("name").innerText = responseText[0].name
                                            document.getElementById("status_search").innerText = responseText[0].status
                                            document.getElementById("id").innerText = responseText[0].id
                                            document.getElementById("UserPfofile_create").innerText = responseText[0].UserPfofile_create.first_name + " " + responseText[0].UserPfofile_create.last_name
                                            document.getElementById("control_date").innerText = responseText[0].create_at + "/" + responseText[0].target_date
                                            {#window.location.reload();#}
                                            if (responseText[0].connection_search == null) {
                                                document.getElementById("connection_search").innerText = "корневая"
                                            } else {
                                                if (responseText[0].UserTasck != undefined) {
                                                    document.getElementById("connection_search").innerText = "связь с задачей №" + JSON.parse(responseText[0].UserTasck).UserTasck
                                                }

                                                if (responseText[0].TechTask != undefined) {
                                                    document.getElementById("connection_search").innerText = "связь с ТЗ"
                                                }


                                            }
                                            UserPfofile_executor_m = []
                                            for (UserPfofile_executor of responseText[0].UserPfofile_executor) {
                                                if (UserPfofile_executor_m.indexOf(UserPfofile_executor) == -1) {
                                                    UserPfofile_executor_m.push(UserPfofile_executor.first_name + " " + UserPfofile_executor.last_name)
                                                }
                                            }
                                            document.getElementById("UserPfofile_executor").innerText = UserPfofile_executor_m.join(", ")

                                            department = []
                                            for (UserPfofile_executor of responseText[0].UserPfofile_executor) {
                                                if (department.indexOf(UserPfofile_executor) == -1) {
                                                    department.push(UserPfofile_executor.department)
                                                }
                                            }
                                            document.getElementById("department").innerText = department.join(", ")


                                            control_m = []
                                            for (control of responseText[0].UserPfofile_control) {
                                                if (control_m.indexOf(control) == -1) {
                                                    control_m.push(control.first_name + " " + control.last_name)
                                                }
                                            }
                                            document.getElementById("control_search").innerText = control_m.join(", ")
                                            if (responseText[0].control.indexOf(window.my_UserPfofile.my_username) == -1) {
                                                control_search
                                                document.getElementById("control_process").innerText = "Взять задачу на котроль"
                                            } else {
                                                document.getElementById("control_process").innerText = "Снять задачу с котроль"

                                            }

                                        }
                                    }

                                    document.getElementById("control_process").onclick = async function (event) {

                                        event.preventDefault();
                                        event_control_process = ""
                                        if (window.update_value_user_id_search_value[0].control.indexOf(window.my_UserPfofile.my_username) == -1) {

                                            event_control_process = "add"
                                        } else {
                                            event_control_process = "del"


                                        }
                                        res = await fetch(`http://127.0.0.1:8000/userprofile/set_Control_Task?id=1&event=${event_control_process}`, {
                                            method: "GET",
                                            headers: {
                                                Accept: 'application/json',
                                                'Content-Type': 'application/json',
                                                "Authorization": getCookieValue("Authorization")
                                            },
                                            {#body: JSON.stringify({})#}
                                        });

                                        let responseText = JSON.parse(await res.text());
                                        if (res.status == 200) {
                                            window.update_value_user_id_search_value = responseText

                                            update_value_user_id_search(responseText)

                                        }
                                    }

                                </script>
                                {#                            end раздел с поиском#}

                                <div class="card mask-custom">
                                    {#                                    <ta class="card-body p-4 text-white">#}

                                    <div class="text-center pt-3 pb-2">
                                        <img src="{{ url_for('static', path='auth/images/check1.webp') }}"
                                             alt="Check" width="60">
                                        <h3 class="my-4">СПИСОК ЗАДАЧ</h3>
                                    </div>

                                    <fieldset>
                                        <legend>Фильтры</legend>

                                        <div>
                                            <input type="checkbox" id="visible_completed" name="visible_completed"
                                                   checked/>
                                            <label for="visible_completed">Скрыть выполненые</label>

                                        </div>
                                        <div>

                                            <input type="checkbox" id="priority_low" name="priority_low"/>
                                            <label for="priority_low">Не важно</label>

                                            <input type="checkbox" id="priority_normal" name="priority_normal"/>
                                            <label for="priority_normal">Нормально</label>

                                            <input type="checkbox" id="priority_high" name="priority_high"/>
                                            <label for="priority_high">Важно</label>
                                        </div>
                                        {#  <div>#}
                                        {#    <input type="checkbox" id="horns" name="horns" />#}
                                        {#    <label for="horns">Horns</label>#}
                                        {#  </div>#}
                                    </fieldset>

                                    <script>
                                        document.getElementById('visible_completed').onchange = async function (event) {
                                            if (event.target.checked) {
                                                for (var i = 1, row; row = document.getElementById('all_user_task').rows[i]; i++) {
                                                    console.log(row.cells[8].innerText)
                                                    if (row.cells[8].innerText.trim() == "Выполнено") {
                                                        row.style.display = 'none';
                                                    }
                                                }

                                            } else {

                                                rows = document.getElementById('all_user_task').getElementsByTagName('tr');
                                                for (var row = 0; row < rows.length; row++) {

                                                    console.log(rows[row])
                                                    console.log(rows[row].cells[8])
                                                    console.log(rows[row].cells[8].innerText.trim())
                                                    if (rows[row].cells[8].innerText.trim() == "Выполнено") {

                                                        rows[row].style.display = "table-row";
                                                    }
                                                }
                                                {#for (var row = 0; row < rows.length; row++) {#}
                                                {#    if (row.cells[8].innerText.trim() == "Выполнено") {#}
                                                {#        rows[row].style.display = "table-row";#}
                                                {#    }#}
                                                //}
                                            }

                                        }
                                        document.getElementById('priority_low').onchange = async function (event) {
                                            if (event.target.checked) {
                                                for (var i = 1, row; row = document.getElementById('all_user_task').rows[i]; i++) {
                                                    console.log(row.cells[7].innerText.trim())
                                                    if (row.cells[7].innerText.trim() == "Не важно") {
                                                        row.style.display = 'none';
                                                    }
                                                }

                                            } else {

                                                rows = document.getElementById('all_user_task').getElementsByTagName('tr');
                                                for (var row = 0; row < rows.length; row++) {

                                                    console.log(rows[row])
                                                    console.log(rows[row].cells[7])
                                                    console.log(rows[row].cells[7].innerText.trim())
                                                    if (rows[row].cells[7].innerText.trim() == "Не важно") {
                                                        if (document.getElementById('visible_completed').checked) {
                                                            if (rows[row].cells[8].innerText.trim() != "Выполнено") {
                                                                rows[row].style.display = "table-row";
                                                            }
                                                        } else {
                                                            rows[row].style.display = "table-row";
                                                        }


                                                    }
                                                }
                                            }
                                        }
                                        document.getElementById('priority_normal').onchange = async function (event) {

                                            if (event.target.checked) {
                                                for (var i = 1, row; row = document.getElementById('all_user_task').rows[i]; i++) {
                                                    console.log(row.cells[7].innerText.trim())
                                                    if (row.cells[7].innerText.trim() == "Нормально") {
                                                        row.style.display = 'none';
                                                    }
                                                }

                                            } else {

                                                rows = document.getElementById('all_user_task').getElementsByTagName('tr');
                                                for (var row = 0; row < rows.length; row++) {

                                                    console.log(rows[row])
                                                    console.log(rows[row].cells[7])
                                                    console.log(rows[row].cells[7].innerText.trim())
                                                    if (rows[row].cells[7].innerText.trim() == "Нормально") {
                                                        if (document.getElementById('visible_completed').checked) {
                                                            if (rows[row].cells[8].innerText.trim() != "Выполнено") {
                                                                rows[row].style.display = "table-row";
                                                            }
                                                        } else {
                                                            rows[row].style.display = "table-row";
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        document.getElementById('priority_high').onchange = async function (event) {

                                            if (event.target.checked) {
                                                for (var i = 1, row; row = document.getElementById('all_user_task').rows[i]; i++) {
                                                    console.log(row.cells[7].innerText.trim())
                                                    if (row.cells[7].innerText.trim() == "Важно") {
                                                        row.style.display = 'none';
                                                    }
                                                }

                                            } else {

                                                rows = document.getElementById('all_user_task').getElementsByTagName('tr');
                                                for (var row = 0; row < rows.length; row++) {

                                                    console.log(rows[row])
                                                    console.log(rows[row].cells[7])
                                                    console.log(rows[row].cells[7].innerText.trim())
                                                    if (rows[row].cells[7].innerText.trim() == "Важно") {
                                                        if (document.getElementById('visible_completed').checked) {
                                                            if (rows[row].cells[8].innerText.trim() != "Выполнено") {
                                                                rows[row].style.display = "table-row";
                                                            }
                                                        } else {
                                                            rows[row].style.display = "table-row";
                                                        }
                                                    }
                                                }
                                            }
                                        }


                                    </script>


                                    <div class="text-center pt-3 pb-2">

                                    </div>

                                    <table class="table text-white mb-0 user-task-table" id="all_user_task">
                                        <thead>
                                        <tr>
                                            <th scope="col">Номер задачи</th>
                                            <th scope="col">Связь</th>
                                            <th scope="col">НАЗВАНИЕ ЗАДАЧИ</th>
                                            <th scope="col">АВТОР</th>
                                            <th scope="col">ИСПОЛНИТЕЛИ</th>
                                            <th scope="col">отдел</th>
                                            <th scope="col">ДАТА НАЗНАЧЕНИЯ/КОНТРОЛЬНЫЙ СРОК</th>
                                            <th scope="col">ПРИОРИТЕТ</th>
                                            <th scope="col">СТАТУС</th>
                                            <th scope="col">РЕШЕНИЕ</th>
                                        </tr>
                                        </thead>
                                        <tbody>


                                        {% for get_UserTask_for in get_UserTask %}

                                            <tr class="mark" id={{ get_UserTask_for.id }}>

                                                {#НОМЕР ЗАДАЧИ#}
                                                <th>
                                                    <span style="font-weight:normal"
                                                          id="number_tasc_{{ get_UserTask_for.id }}"
                                                          class="ms-2">{{ get_UserTask_for.id|safe }}</span>
                                                </th>


                                                {#связь#}
                                                <th>
                                                    {% if get_UserTask_for.connection|safe  == "None" or  get_UserTask_for.connection|safe  == "" %}

                                                        <span style="font-weight:normal"
                                                              id="connection_tasc_{{ get_UserTask_for.id }}"
                                                              class="ms-2">корневое</span>

                                                    {% else %}

                                                        <span style="font-weight:normal"
                                                              id="connection_tasc_{{ get_UserTask_for.id }}"
                                                              class="ms-2"></span>
                                                        <script>
                                                            if (JSON.parse({{ get_UserTask_for.connection|tojson }})["UserTasck"] != undefined) {
                                                                document.getElementById("connection_tasc_{{ get_UserTask_for.id }}").innerText = "связь с задачей №" + JSON.parse({{ get_UserTask_for.connection|tojson }}).UserTasck

                                                            }
                                                            if (JSON.parse({{ get_UserTask_for.connection|tojson }})["TechTask"] != undefined) {
                                                                document.getElementById("connection_tasc_{{ get_UserTask_for.id }}").innerText = "связь ТЗ"

                                                            }
                                                        </script>
                                                    {% endif %}

                                                </th>


                                                {#НАЗВАНИЕ ЗАДАЧИ#}
                                                <th>
                                                    <span style="font-weight:normal"
                                                          id="name_tasc_{{ get_UserTask_for.id }}"
                                                          class="ms-2">{{ get_UserTask_for.name|safe }}</span>
                                                </th>

                                                {#АВТОР#}
                                                <td class="align-middle">
                                                    <span>{{ get_UserTask_for.UserPfofile_create.first_name }} {{ get_UserTask_for.UserPfofile_create.last_name }}</span>
                                                </td>


                                                {#ИСПОЛНИТЕЛИ#}
                                                <td class="align-middle">
                                                    {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor }}</span>#}
                                                    {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor  }}</span>#}

                                                    {% for UserPfofile_executor_for in get_UserTask_for.UserPfofile_executor %}
                                                        <span>{{ UserPfofile_executor_for.first_name }} {{ UserPfofile_executor_for.last_name }},</span>

                                                    {% endfor %}

                                                </td>


                                                {#отдел исполнителей#}
                                                <td class="align-middle">
                                                    {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor }}</span>#}
                                                    {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor  }}</span>#}

                                                    {% for UserPfofile_executor_for in get_UserTask_for.UserPfofile_executor %}
                                                        <span>{{ UserPfofile_executor_for.department }},</span>

                                                    {% endfor %}

                                                </td>

                                                {#ДАТА НАЗНАЧЕНИЯ#}
                                                <td class="align-middle">
                                                    <span>{{ get_UserTask_for.create_at }}/{{ get_UserTask_for.target_date }}</span>

                                                </td>


                                                {#ПРИОРИТЕТ#}
                                                <td class="align-middle">
                                                    <h6 class="mb-0">

                                                        {% if get_UserTask_for.priority|lower == "Важно"|lower %}
                                                            <span class="badge bg-danger">{{ get_UserTask_for.priority }}</span>
                                                        {% elif get_UserTask_for.priority|lower == "Нормально"|lower %}
                                                            <span class="badge bg-warning">{{ get_UserTask_for.priority }}</span>
                                                        {% else %}
                                                            <span class="badge bg-success">{{ get_UserTask_for.priority }}</span>
                                                        {% endif %}
                                                    </h6>
                                                </td>

                                                {#CТАТУС#}
                                                <td class="align-middle">
                                                    <span id="status_{{ get_UserTask_for.id }}">{{ get_UserTask_for.status }}</span>


                                                </td>
                                                <script>
                                                    {#if (({{ get_UserTask_for.status|tojson }}) == 'Выполнено') {#}
                                                    {#    document.getElementById("status_{{ get_UserTask_for.id }}").parentElement.parentElement.style.display = 'none'#}
                                                    //}
                                                </script>
                                                {#РЕШЕНИЕ#}
                                                <td class="align-middle">
                                                    <span id="result_value_{{ get_UserTask_for.id }}">{{ get_UserTask_for.result }}</span>

                                                    {% if get_UserTask_for.status|lower == "Выполнено"|lower and  get_my_UserPfofile.username|lower == get_UserTask_for.user_create|lower %}
                                                        {##}
                                                        <button id="get_back_to_work_{{ get_UserTask_for.id }}">
                                                            Вернуть в работу
                                                        </button>
                                                    {% endif %}

                                                    {% if get_UserTask_for.status|lower == "В Работе"|lower or  get_UserTask_for.status|lower == "Назначена"|lower  or  get_UserTask_for.status|lower == "Возврат в работу"|lower %}


                                                        {% if get_UserTask_for.status|lower == "В Работе"|lower %}
                                                            {% if get_my_UserPfofile.username|lower != get_UserTask_for.user_create|lower %}

                                                                <button id="process_{{ get_UserTask_for.id }}">
                                                                    Выполнить
                                                                    задачу
                                                                </button>
                                                            {% else %}
                                                                <label id="process_{{ get_UserTask_for.id }}">В
                                                                    работе
                                                                </label>
                                                            {% endif %}
                                                        {% endif %}

                                                        {% if get_UserTask_for.status|lower == "Назначена"|lower or  get_UserTask_for.status|lower == "Возврат в работу"|lower %}

                                                            {% if get_my_UserPfofile.username|lower != get_UserTask_for.user_create|lower %}

                                                                <button id="process_{{ get_UserTask_for.id }}">Взять
                                                                    в
                                                                    работу
                                                                </button>
                                                            {% else %}
                                                                <label id="process_{{ get_UserTask_for.id }}">Не
                                                                    взято в
                                                                    работу
                                                                </label>
                                                            {% endif %}
                                                        {% endif %}




                                                    {% endif %}


                                                </td>

                                                <div id="overlay"></div>
                                                <div class="container">


                                                    <div id="popup" class="popup">
                                                        <!--  Создадим div, в который обернем заголовок и кнопки, а затем применем стили -->
                                                        <div class="popup__content">
                                                            <h2 class="popup__title">
                                                                Результат работы
                                                            </h2>

                                                            <label>Код закрытия</label>
                                                            <select id="kod" class="form-control" required>
                                                                <option>Выполнено</option>
                                                                <option>Отказ выполнять</option>
                                                            </select>

                                                            <label>Решение</label>
                                                            <textarea id="result" class="form-control" rows="3"
                                                                      placeholder="Введите резултаты работы"></textarea>
                                                        </div>
                                                        <div class="btn-container">

                                                            <button id="yes-btn" class="popup__button" required>
                                                                Сохранить
                                                            </button>
                                                            <button id="no-btn" class="popup__button">
                                                                Отмена
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div id="success" class="popup">
                                                    <!--  Создадим div, в который обернем заголовок и кнопки, а затем применем стили -->
                                                    <div class="popup__content">
                                                        <h2 class="popup__title">
                                                            Выполнено
                                                        </h2>
                                                        <svg class="checkmark" viewBox="0 0 52 52">
                                                            <circle class="checkmark__circle" cx="26" cy="26" r="25"
                                                                    fill="none"/>
                                                            <path class="checkmark__check" fill="none"
                                                                  d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                                                        </svg>

                                                        <button id="good" class="popup__button">
                                                            Отлично
                                                        </button>

                                                    </div>
                                                </div>


                                                <div id="overlay_get_back_to_work"></div>
                                                <div class="container">


                                                    <div id="popup_get_back_to_work" class="popup">
                                                        <!--  Создадим div, в который обернем заголовок и кнопки, а затем применем стили -->
                                                        <div class="popup__content_get_back_to_work">
                                                            <h2 class="popup__title_get_back_to_work">
                                                                Возврат обращения в работу
                                                            </h2>


                                                            <label>Причина возврата</label>
                                                            <textarea id="result_get_back_to_work" class="form-control"
                                                                      rows="3"
                                                                      placeholder="Причина возврата"></textarea>
                                                        </div>
                                                        <div class="btn-container">

                                                            <button id="yes-btn_get_back_to_work" class="popup__button"
                                                                    required>
                                                                Вернуть в работу
                                                            </button>
                                                            <button id="no-btn_get_back_to_work" class="popup__button">
                                                                Отмена
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div id="get_back_to_work_success" class="popup_get_back_to_work">
                                                    <!--  Создадим div, в который обернем заголовок и кнопки, а затем применем стили -->
                                                    <div class="popup__content_get_back_to_work">
                                                        <h2 class="popup__title_get_back_to_work">
                                                            Выполнено
                                                        </h2>
                                                        <svg class="checkmark" viewBox="0 0 52 52">
                                                            <circle class="checkmark__circle" cx="26" cy="26" r="25"
                                                                    fill="none"/>
                                                            <path class="checkmark__check" fill="none"
                                                                  d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                                                        </svg>

                                                        <button id="get_back_to_work_good"
                                                                class="popup__button_get_back_to_work">
                                                            Отлично
                                                        </button>

                                                    </div>
                                                </div>


                                            </tr>


                                        {% endfor %}

                                    </table>
                                </div>
                                {# start    блок с формированием задачи#}
                                <H4 id="Type_label">Сформировать новую задач на сотрудников (по ФИО, Отделу,
                                    Роли)</H4>

                                <div class="form-group">
                                    <label id="Type_label">Создать связанную подзадачу для задачи, необходимо
                                        выбрать
                                        номер задачи для связки из списка</label>
                                    <select id="connection" class="form-control">
                                        <option value=None>Корневая</option>
                                        {% for get_UserTask_for in get_UserTask %}
                                            <option value='{"UserTasck":"{{ get_UserTask_for.id|safe }}"}'>{{ get_UserTask_for.id|safe }}</option>
                                        {% endfor %}

                                    </select>
                                </div>

                                {% include "Form_User_Tasck.html" %}

                                <script>

                                    // ?id=1254&age=24
                                    let paramsString = document.location.search;
                                    if (paramsString != '') {
                                        console.log("paramsString", paramsString)
                                        if (paramsString == '?id=in%20work') {
                                            for (var i = 1, row; row = document.getElementById('all_user_task').rows[i]; i++) {
                                                console.log(document.getElementById('all_user_task').rows[i].cells[9])
                                                if (row.cells[9].innerText.trim() != "В работе") {
                                                    row.style.display = 'none';
                                                }
                                            }
                                        }
                                    }


                                    document.getElementById("Opisanie_text").onkeypress = function (e) {
                                        var chr = String.fromCharCode(e.which);
                                        if ("&".indexOf(chr) != -1)
                                            return false;
                                    };
                                    document.getElementById('Otpravka_roles_button').onclick = async function () {
                                        event.preventDefault();
                                        valid = true
                                        if (document.getElementById('Opisanie_text').value == "") {
                                            valid = false
                                            document.getElementById('Opisanie_text').setAttribute("required", true)
                                        }
                                        if (document.getElementById('DateEndWork').value == "") {
                                            valid = false
                                            document.getElementById('DateEndWork').setAttribute("required", true)

                                        }
                                        if (valid == false) {
                                            return
                                        } else {
                                            console.log(document.getElementById('Opisanie_text').value)
                                            user = []
                                            user.push(document.getElementById('Otpravka_roles').value)
                                            if (document.getElementById('Type').value == "username") {
                                                {#if document.getElementById("connection").value#}
                                                connection = document.getElementById("connection").value
                                                {#console.log(connection)#}
                                                {#console.log(JSON.stringify({connection}))#}
                                                URL = `/userprofile/createUserTask?name=${document.getElementById('Opisanie_text').value}&user_executor=${JSON.stringify(user)}&status=%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B0&result=&target_date=${document.getElementById('DateEndWork').value}&notification_holder=false&notification_executor=true&priority=${document.getElementById('priority').value}&connection=${connection}`
                                            } else {
                                                connection = document.getElementById("connection").value
                                                URL = `/userprofile/createUserTaskRoles?name=${document.getElementById('Opisanie_text').value}&user_executor=${JSON.stringify(user)}&status=%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B0&result=&target_date=${document.getElementById('DateEndWork').value}&notification_holder=false&notification_executor=true&priority=${document.getElementById('priority').value}&connection=${connection}`
                                            }


                                            {#     if (document.getElementById('Type').value=="username"){#}
                                            {#   URL= `/userprofile/createUserTask?name=<a href="${window.location.href}"> {{getTechTaskName.NameTechTask|tojson|safe}}</a> Комментарий к задаче: ${document.getElementById('Otpravka_roles_text').value}&user_executor=${JSON.stringify(user)}&status=%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B0&result=&target_date=${document.getElementById('DateEndWork').value}&notification_holder=false&notification_executor=true&connection=${JSON.stringify({"TechTask":{{getTechTaskName.id|tojson|safe}}})}&priority=${document.getElementById('priority').value}`#}
                                            {#//}#}
                                            {#     else{#}
                                            {##}
                                            {#   URL= `/userprofile/createUserTaskRoles?name=Ссылка на ТЗ <a href="${window.location.href}"> {{getTechTaskName.NameTechTask|tojson|safe}}</a> Комментарий к задаче: ${document.getElementById('Otpravka_roles_text').value}&user_executor=${JSON.stringify(user)}&status=%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B0&result=&target_date=${document.getElementById('DateEndWork').value}&notification_holder=false&notification_executor=true&connection=${JSON.stringify({"TechTask":{{getTechTaskName.id|tojson|safe}}})}&priority=${document.getElementById('priority').value}`#}
                                            {#//}#}


                                            res = await fetch(URL, {
                                                method: "GET",
                                                headers: {
                                                    Accept: 'application/json',
                                                    'Content-Type': 'application/json',
                                                    "Authorization": getCookieValue("Authorization")
                                                },
                                                {#body: JSON.stringify({})#}
                                            });
                                            console.log("res.status", res.status)
                                            if (res.status == 200) {
                                                console.log(res.status)
                                                {#window.location.reload();#}
                                            } else {
                                                showToast("Ошибка", "error", 5000);

                                            }
                                        }
                                    }
                                    document.getElementById('Otpravka_roles').onchange = async function (event) {
                                        document.getElementById("Opisanie_forms").style.display = "block";
                                        document.getElementById("button_forms").style.display = "block";

                                    }
                                    document.getElementById('Type').onchange = async function (event) {
                                        event.preventDefault();

                                        removeOptions(document.getElementById('Otpravka_roles'));
                                        var opt = document.createElement('option');
                                        opt.innerHTML = "<option disabled selected value> --Выберите-- </option>"
                                        document.getElementById('Otpravka_roles').appendChild(opt);
                                        if ($(this).val() == "roles") {
                                            document.getElementById("Opisanie_forms").style.display = "none";
                                            document.getElementById("button_forms").style.display = "none";
                                            document.getElementById("Otpravka_roles_forms").style.display = "block";


                                            values = {{ all_roles|tojson|safe }}
                                            for (value of Object.keys(values)) {
                                                var opt = document.createElement('option');
                                                opt.value = value
                                                opt.innerHTML = values[value]
                                                document.getElementById('Otpravka_roles').appendChild(opt);
                                            }
                                        }

                                        if ($(this).val() == "username") {
                                            document.getElementById("Otpravka_roles_forms").style.display = "block";

                                            values = {{ all_user|tojson|safe }}
                                            for (value of Object.keys(values)) {
                                                if (window.my_UserPfofile.my_username != value) {
                                                    var opt = document.createElement('option');
                                                    opt.value = value
                                                    opt.innerHTML = values[value]
                                                    document.getElementById('Otpravka_roles').appendChild(opt);

                                                }
                                            }
                                        }
                                    }

                                    async function updatde_UserTask(data, e, name_task, rezult_task) {
                                        console.log("datadata", data)
                                        console.log("datadata", e)
                                        {#console.log("useruseruseruser", window.get_UserTask[data.id.id - 1].user_create)#}
                                        let data_analiz = window.get_UserTask
                                        console.log("useruseruseruser", data_analiz)
                                        data_analiz.forEach(function (val, id) {
                                            if (val.id == data.id.id) {
                                                iskomiy_id = id
                                                console.log("111", val.name)
                                                console.log("111", val.user_create)
                                                return
                                            }
                                        })
                                        console.log("iskomiy_idiskomiy_id", iskomiy_id)
                                        res = await fetch('/userprofile/updateUserTasck', {
                                            method: "POST",
                                            headers: {
                                                Accept: 'application/json',
                                                'Content-Type': 'application/json',
                                                "Authorization": getCookieValue("Authorization")
                                            },
                                            body: JSON.stringify(data)
                                        });
                                        console.log("res.status", res.status)
                                        if (res.status == 200) {
                                            console.log("res.data", data)
                                            console.log("res.data", data["id"]["id"])

                                            document.getElementById("status_" + data["id"]["id"]).innerText = data["user_data"]["status"]


                                            if (data["user_data"]["status"] == "В Работе") {
                                                console.log("В Работе")

                                                document.getElementById(e.target.id).innerText = "Выполнить задачу"
                                                showToast("Задача взята в работу", "info", 5000);
                                                String(e.target.id).slice(String(e.target.id).lastIndexOf("_") + 1)
                                                {#get_UserTask_global()#}
                                                send_telegram(data_analiz[iskomiy_id].user_create, `Задача <${name_task}> взята в работу`)

                                            }

                                            if (data["user_data"]["status"] == "Выполнено") {
                                                console.log("Выполнена")

                                                document.getElementById("process_" + data["id"]["id"]).style = "display: none;"
                                                document.getElementById("result_value_" + data["id"]["id"]).innerText = data["user_data"]["result"]
                                                send_telegram(data_analiz[iskomiy_id].user_create, `Задача <${name_task}> выполнена с решением: <${rezult_task}>`)

                                                document.getElementById("success").style.display = "block";
                                                document.getElementById("popup").style.display = "none";
                                                {#document.getElementById("overlay").classList.add("show");#}
                                                document.getElementById("overlay").classList.remove("show");


                                            }

                                            if (data["user_data"]["status"] == "Возврат в работу") {
                                                console.log("Возврат в работу")
                                                console.log("data", data)

                                                document.getElementById("get_back_to_work_" + data["id"]["id"]).style = "display: none;"
                                                document.getElementById("result_value_" + data["id"]["id"]).innerText = data["user_data"]["result"]
                                                send_telegram(data_analiz[iskomiy_id].user_create, `Задача <${name_task}> вернули в работу с решением: <${rezult_task}>`)

                                                document.getElementById("success").style.display = "block";
                                                document.getElementById("popup_get_back_to_work").style.display = "none";
                                                {#document.getElementById("overlay").classList.add("show");#}
                                                document.getElementById("overlay").classList.remove("show");


                                            }


                                        } else {
                                            showToast("Ошибка", "error", 5000);

                                        }
                                    }

                                    window.get_UserTask = {{ get_UserTask|tojson|safe}}
                                    for (v of {{ get_UserTask|tojson|safe}}) {

                                        console.log("username", {{ get_my_UserPfofile.username|tojson|safe }})
                                        console.log("username", v.user_create)
                                        console.log("username", {{ get_my_UserPfofile.username|tojson|safe }} != v.user_create)
                                        console.log("username", v.status)
                                        console.log("username", v.user_executor.split("'").join('"'))

                                        console.log("v.id", v)
                                        console.log("v.id", v.id)
                                        console.log("get_my_UserPfofileget_my_UserPfofile", {{ get_my_UserPfofile.username|tojson|safe }})

                                        if (v.status != "Выполнено") {//&& {{ get_my_UserPfofile|tojson|safe }} != v.user_create && JSON.parse(v.user_executor.split("'").join('"')).indexOf({{ get_my_UserPfofile.username|tojson|safe }})!=-1


                                            document.getElementById("process_" + v.id).addEventListener("click", (e) => {
                                                console.log("get_UserTask_for.id", e)

                                                if (e.target.localName != "label") {

                                                    console.log("get_UserTask_for.id", e)
                                                    console.log("get_UserTask_for.id", e.target.localName)
                                                    console.log("get_UserTask_for.id", document.getElementById(e.target.id))

                                                    if (document.getElementById(e.target.id).innerText == "Взять в работу") {

                                                        data = {
                                                            "user_data": {
                                                                "status": "В Работе",
                                                                "result": "",
                                                                "notification_holder": false,
                                                                "notification_executor": false
                                                            },
                                                            "id": {
                                                                "id": e.target.id.replace("process_", "")
                                                            }
                                                        }
                                                        updatde_UserTask(data, e, document.getElementById("name_tasc_" + data["id"]["id"]).innerText)

                                                        {#get_UserTask()#}
                                                    } else {
                                                        document.getElementById("popup").style.display = "block";
                                                        document.getElementById("overlay").classList.add("show");
                                                        document.getElementById("yes-btn").className += " " + String(e.target.id).slice(String(e.target.id).lastIndexOf("_") + 1)
                                                        document.getElementById("result").value = ""
                                                        document.getElementById("kod").value = ""

                                                    }
                                                }

                                            });
                                        } else {
                                            console.log("else Выполнено Возврат в работу", v.id)
                                            console.log(v.user_create)
                                            console.log({{ get_my_UserPfofile.username|tojson|safe }})
                                            console.log({{ get_my_UserPfofile.username|tojson|safe }} == v.user_create)
                                            console.log(v.status)
                                            console.log(v.status != "Возврат в работу")
                                            console.log(v.status == "Выполнено")

                                            if ({{ get_my_UserPfofile.username|tojson|safe }} == v.user_create && (v.status == "Выполнено" || v.status != "Возврат в работу")) {
                                                console.log("попал else Выполнено Возврат в работу", v.id)

                                                document.getElementById("get_back_to_work_" + v.id).addEventListener("click", (e) => {

                                                        document.getElementById("popup_get_back_to_work").style.display = "block";
                                                        document.getElementById("overlay").classList.add("show");
                                                        document.getElementById("yes-btn_get_back_to_work").className = "popup__button " + String(e.target.id).slice(String(e.target.id).lastIndexOf("_") + 1)
                                                        document.getElementById("result_get_back_to_work").innerText = document.getElementById("result_value_" + v.id).innerText

                                                    }
                                                )
                                            }


                                        }

                                    }


                                    document.getElementById("good").addEventListener("click", () => {
                                        document.getElementById("success").style.display = "none";
                                        document.getElementById("overlay").classList.remove("show");
                                    });

                                    document.getElementById("no-btn").addEventListener("click", () => {
                                        document.getElementById("popup").style.display = "none";
                                        document.getElementById("overlay").classList.remove("show");
                                    });

                                    document.getElementById("yes-btn").addEventListener("click", (e) => {

                                        if (document.getElementById("kod").value == "") {
                                            showToast("Необходимо заполнить поля", "error", 5000);
                                            document.getElementById("kod").setAttribute("required", true)
                                            return
                                        }

                                        if (document.getElementById("result").value == "") {
                                            showToast("Необходимо заполнить поля", "error", 5000);
                                            document.getElementById("result").setAttribute("required", true)
                                            return
                                        }
                                        if (document.getElementById("result").value == "" && document.getElementById("kod").value == "") {


                                            console.log(document.getElementById("yes-btn").className.split(" ")[document.getElementById("yes-btn").className.split(" ").length - 1])

                                            data = {
                                                "user_data": {
                                                    "status": document.getElementById("kod").value,
                                                    "result": document.getElementById("result").value,
                                                    "notification_holder": true,
                                                    "notification_executor": false
                                                },
                                                "id": {
                                                    "id": document.getElementById("yes-btn").className.split(" ")[document.getElementById("yes-btn").className.split(" ").length - 1]
                                                }
                                            }
                                            updatde_UserTask(data, e, document.getElementById("name_tasc_" + data["id"]["id"]).innerText, document.getElementById("result").value)

                                        }


                                    });


                                    document.getElementById("no-btn_get_back_to_work").addEventListener("click", () => {
                                        document.getElementById("popup_get_back_to_work").style.display = "none";
                                        document.getElementById("overlay").classList.remove("show");
                                    });

                                    document.getElementById("yes-btn_get_back_to_work").addEventListener("click", (e) => {

                                        console.log(document.getElementById("yes-btn_get_back_to_work").className.split(" ")[1])

                                        data = {
                                            "user_data": {
                                                "status": "Возврат в работу",
                                                "result": document.getElementById("result_get_back_to_work").value,
                                                "notification_holder": false,
                                                "notification_executor": true
                                            },
                                            "id": {
                                                "id": document.getElementById("yes-btn").className.split(" ")[document.getElementById("yes-btn").className.split(" ").length - 1]
                                            }
                                        }
                                        updatde_UserTask(data, e, document.getElementById("name_tasc_" + data["id"]["id"]).innerText, document.getElementById("result").value)


                                    });

                                </script>


                                {#                                <tr class="fw-normal">#}
                                {#                                    <th>#}
                                {#                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava2-bg.webp"#}
                                {#                                             alt="avatar 1" style="width: 45px; height: auto;">#}
                                {#                                        <span class="ms-2">Kate Moss</span>#}
                                {#                                    </th>#}
                                {#                                    <td class="align-middle">Make payment to Bluedart</td>#}
                                {#                                    <td class="align-middle">#}
                                {#                                        <h6 class="mb-0"><span class="badge bg-success">Low priority</span>#}
                                {#                                        </h6>#}
                                {#                                    </td>#}
                                {#                                    <td class="align-middle">#}
                                {#                                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i#}
                                {#                                                class="fas fa-check fa-lg text-success me-3"></i></a>#}
                                {#                                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i#}
                                {#                                                class="fas fa-trash-alt fa-lg text-warning"></i></a>#}
                                {#                                    </td>#}
                                {#                                </tr>#}
                                {#                                <tr class="fw-normal">#}
                                {#                                    <th>#}
                                {#                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"#}
                                {#                                             alt="avatar 1" style="width: 45px; height: auto;">#}
                                {#                                        <span class="ms-2">Danny McChain</span>#}
                                {#                                    </th>#}
                                {#                                    <td class="align-middle">Office rent</td>#}
                                {#                                    <td class="align-middle">#}
                                {#                                        <h6 class="mb-0"><span#}
                                {#                                                class="badge bg-warning">Middle priority</span></h6>#}
                                {#                                    </td>#}
                                {#                                    <td class="align-middle">#}
                                {#                                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i#}
                                {#                                                class="fas fa-check fa-lg text-success me-3"></i></a>#}
                                {#                                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i#}
                                {#                                                class="fas fa-trash-alt fa-lg text-warning"></i></a>#}
                                {#                                    </td>#}
                                {#                                </tr>#}
                                {#                                <tr class="fw-normal">#}
                                {#                                    <th>#}
                                {#                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava5-bg.webp"#}
                                {#                                             alt="avatar 1" style="width: 45px; height: auto;">#}
                                {#                                        <span class="ms-2">Alexa Chung</span>#}
                                {#                                    </th>#}
                                {#                                    <td class="align-middle">Office grocery shopping</td>#}
                                {#                                    <td class="align-middle">#}
                                {#                                        <h6 class="mb-0"><span class="badge bg-danger">High priority</span>#}
                                {#                                        </h6>#}
                                {#                                    </td>#}
                                {#                                    <td class="align-middle">#}
                                {#                                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i#}
                                {#                                                class="fas fa-check fa-lg text-success me-3"></i></a>#}
                                {#                                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i#}
                                {#                                                class="fas fa-trash-alt fa-lg text-warning"></i></a>#}
                                {#                                    </td>#}
                                {#                                </tr>#}
                                {#                                <tr class="fw-normal">#}
                                {#                                    <th class="border-0">#}
                                {#                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp"#}
                                {#                                             alt="avatar 1" style="width: 45px; height: auto;">#}
                                {#                                        <span class="ms-2">Ben Smith</span>#}
                                {#                                    </th>#}
                                {#                                    <td class="border-0 align-middle">Ask for Lunch to Clients</td>#}
                                {#                                    <td class="border-0 align-middle">#}
                                {#                                        <h6 class="mb-0"><span class="badge bg-success">Low priority</span>#}
                                {#                                        </h6>#}
                                {#                                    </td>#}
                                {#                                    <td class="border-0 align-middle">#}
                                {##}
                                {#                                                    <a href="#!"><i class="fa fa-bell fa-10x" ></i></a>#}
                                {#                                        <a href="#!"><i class="fa fa-camera-retro fa-10x"></i></a>#}
                                {#                                        <a href="#!"><i class="fa fa-home fa-10"></i></a>#}
                                {#    <div><i class="fa fa-envelope"></i> - envelope icon</div>#}
                                {#    <div> <i class="fa fa-phone"></i> - phone icon</div>#}
                                {#    <div> <i class="fa fa-search"></i> - search icon</div>#}
                                {#    <div><i class="fa fa-shopping-cart"></i> - shopping cart icon</div>#}
                                {#    <div> <i class="fa fa-user"></i> - user icon</div>#}
                                {#    <div> <i class="fa fa-heart"></i> - heart icon</div>#}
                                {#    <div><i class="fa fa-play"></i> - play icon</div>#}
                                {#    <div> <i class="fa fa-cog"></i> - cog/gear icon</div>#}
                                {#    <div><i class="fa fa-home"></i> - trash icon</div>#}
                                {#    <div> <i class="fa fa-check"></i> - checkmark icon</div>#}
                                {#                                    </td>#}
                                {#                                </tr>#}
                                </tbody>
                                </table>

                                {# end    блок с формированием задачи#}

                                <div class="text-center pt-3 pb-2">
                                    <img src="{{ url_for('static', path='auth/images/check1.webp') }}"
                                         alt="Check" width="60">
                                    <h3 class="my-4">ЗАДАЧИ НА КОНТРОЛЕ</h3>

                                </div>

                                <table class="table text-white mb-0 user-task-table" id="all_user_task">
                                    <thead>
                                    <tr>
                                        <th scope="col">Номер задачи</th>
                                        <th scope="col">Связь</th>
                                        <th scope="col">НАЗВАНИЕ ЗАДАЧИ</th>
                                        <th scope="col">АВТОР</th>
                                        <th scope="col">ИСПОЛНИТЕЛИ</th>
                                        <th scope="col">отдел</th>
                                        <th scope="col">ДАТА НАЗНАЧЕНИЯ/КОНТРОЛЬНЫЙ СРОК</th>
                                        <th scope="col">ПРИОРИТЕТ</th>
                                        <th scope="col">СТАТУС</th>
                                        <th scope="col">РЕШЕНИЕ</th>
                                        <th scope="col">СНЯТЬ С КОНТРОЛЯ</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    {% for get_UserTask_for in UserTask_Control %}

<script>
    console.log("UserTask_ControlUserTask_Control",{{ UserTask_Control|tojson}})
</script>
                                        <tr class="mark" id={{ get_UserTask_for.id }}>

                                            {#НОМЕР ЗАДАЧИ#}
                                            <th>
                                                    <span style="font-weight:normal"
                                                          id="number_tasc_{{ get_UserTask_for.id }}"
                                                          class="ms-2">{{ get_UserTask_for.id|safe }}</span>
                                            </th>


                                            {#связь#}
                                            <th>
                                                {% if get_UserTask_for.connection|safe  == "None" or  get_UserTask_for.connection|safe  == "" %}

                                                    <span style="font-weight:normal"
                                                          id="connection_tasc_{{ get_UserTask_for.id }}"
                                                          class="ms-2">корневое</span>

                                                {% else %}

                                                    <span style="font-weight:normal"
                                                          id="connection_tasc_{{ get_UserTask_for.id }}"
                                                          class="ms-2"></span>
                                                    <script>
                                                        if (JSON.parse({{ get_UserTask_for.connection|tojson }})["UserTasck"] != undefined) {
                                                            document.getElementById("connection_tasc_{{ get_UserTask_for.id }}").innerText = "связь с задачей №" + JSON.parse({{ get_UserTask_for.connection|tojson }}).UserTasck

                                                        }
                                                        if (JSON.parse({{ get_UserTask_for.connection|tojson }})["TechTask"] != undefined) {
                                                            document.getElementById("connection_tasc_{{ get_UserTask_for.id }}").innerText = "связь ТЗ"

                                                        }
                                                    </script>
                                                {% endif %}

                                            </th>


                                            {#НАЗВАНИЕ ЗАДАЧИ#}
                                            <th>
                                                    <span style="font-weight:normal"
                                                          id="name_tasc_{{ get_UserTask_for.id }}"
                                                          class="ms-2">{{ get_UserTask_for.name|safe }}</span>
                                            </th>

                                            {#АВТОР#}
                                            <td class="align-middle">
                                                <span>{{ get_UserTask_for.UserPfofile_create.first_name }} {{ get_UserTask_for.UserPfofile_create.last_name }}</span>
                                            </td>


                                            {#ИСПОЛНИТЕЛИ#}
                                            <td class="align-middle">
                                                {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor }}</span>#}
                                                {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor  }}</span>#}

                                                {% for UserPfofile_executor_for in get_UserTask_for.UserPfofile_executor %}
                                                    <span>{{ UserPfofile_executor_for.first_name }} {{ UserPfofile_executor_for.last_name }},</span>

                                                {% endfor %}

                                            </td>


                                            {#отдел исполнителей#}
                                            <td class="align-middle">
                                                {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor }}</span>#}
                                                {#                                                    <span>{{ get_UserTask_for.UserPfofile_executor  }}</span>#}

                                                {% for UserPfofile_executor_for in get_UserTask_for.UserPfofile_executor %}
                                                    <span>{{ UserPfofile_executor_for.department }},</span>

                                                {% endfor %}

                                            </td>

                                            {#ДАТА НАЗНАЧЕНИЯ#}
                                            <td class="align-middle">
                                                <span>{{ get_UserTask_for.create_at }}/{{ get_UserTask_for.target_date }}</span>

                                            </td>


                                            {#ПРИОРИТЕТ#}
                                            <td class="align-middle">
                                                <h6 class="mb-0">

                                                    {% if get_UserTask_for.priority|lower == "Важно"|lower %}
                                                        <span class="badge bg-danger">{{ get_UserTask_for.priority }}</span>
                                                    {% elif get_UserTask_for.priority|lower == "Нормально"|lower %}
                                                        <span class="badge bg-warning">{{ get_UserTask_for.priority }}</span>
                                                    {% else %}
                                                        <span class="badge bg-success">{{ get_UserTask_for.priority }}</span>
                                                    {% endif %}
                                                </h6>
                                            </td>

                                            {#CТАТУС#}
                                            <td class="align-middle">
                                                <span id="status_{{ get_UserTask_for.id }}">{{ get_UserTask_for.status }}</span>

                                            </td>

                                            {#РЕШЕНИЕ#}
                                            <td class="align-middle">
                                                <span id="result_value_{{ get_UserTask_for.id }}">{{ get_UserTask_for.result }}</span>

                                            </td>
                                            {#СНЯТЬ С КОНТРОЛЯ#}
                                            <td class="align-middle">
                                                <span id="control_search_{{ get_UserTask_for.id }}" style="font-weight:normal"
                                                                  class="ms-2"></span>
                                                <button id="control_process_{{ get_UserTask_for.id }}">
                                                    Снять задачу с котроль
                                                </button>
                                            </td>

                                          <script>
                                            control_m = []
                                            for (control of {{ get_UserTask_for.UserPfofile_control|tojson }} ){
                                                if (control_m.indexOf(control) == -1) {
                                                    control_m.push(control.first_name + " " + control.last_name)
                                                }
                                            }
                                            document.getElementById("control_search_"+{{ get_UserTask_for.id }}).innerText = control_m.join(", ")

                                        document.getElementById("control_process_{{ get_UserTask_for.id }}").onclick = async function (event) {

                                            event.preventDefault();
                                            event_control_process = ""
                                            if (window.update_value_user_id_search_value[0].control.indexOf(window.my_UserPfofile.my_username) == -1) {

                                                event_control_process = "add"
                                            } else {
                                                event_control_process = "del"


                                            }
                                            res = await fetch(`http://127.0.0.1:8000/userprofile/set_Control_Task?id=1&event=${event_control_process}`, {
                                                method: "GET",
                                                headers: {
                                                    Accept: 'application/json',
                                                    'Content-Type': 'application/json',
                                                    "Authorization": getCookieValue("Authorization")
                                                },
                                                {#body: JSON.stringify({})#}
                                            });

                                            let responseText = JSON.parse(await res.text());
                                            if (res.status == 200) {
                                                window.update_value_user_id_search_value = responseText

                                                update_value_user_id_search(responseText)

                                            }
                                        }
                                    </script>
                                        </tr>



                                    {% endfor %}


                                </table>
                            </div>
                        </div>

                    </div>
                </section>
            </div>
        </div>
        <!-- /. PAGE INNER  -->
    </div>
    <!-- /. PAGE WRAPPER  -->
</div>


{% include "indexShablon_end.html" %}

<!-- Создадим контейнер, чтобы спозиционировать элементы интерфейса на экране -->


</body>

</html>

