<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
        {% include "indexShablon_head.html" %}

</head>
<body class="initial">
<div class="containerNewDesign">
    <div class="left-menu">
        <div class="box">
            <a href="../newDesign/newDesign" class="not_active_menu">
                <img src="{{ url_for('static', path='auth/images/home.png') }}" alt="" width="30">
            </a>
        </div>
        <div class="box">
            <a href="#" class="not_active_menu">
                <img src="{{ url_for('static', path='auth/images/messenger.png') }}" alt="" width="30">
            </a>
        </div>
        <div class="box">
            <a href="../newDesign/newDesignCustomers" class="active_menu">
{#            style="background: #e7e7e7; "#}
                <img src="{{ url_for('static', path='auth/images/people.png') }}" alt="" width="30">
            </a>
        </div>
        <div class="box">
            <a href="#" class="not_active_menu">
                <img src="{{ url_for('static', path='auth/images/settings.png') }}" alt="" width="30">
            </a>
        </div>
    </div>
    <div class="head">
        <div class="left-head">
            <img src="{{ url_for('static', path='auth/images/bricks.png') }}" alt="" width="50"> MTI Manager
        </div>
        <div class="subhead_head">
            <div class="searchBox search-head">
                                <input class="searchInput" type="search" name="" placeholder="Search" style="all: unset;">
                                <a href="#" class="search-btn">
                                    <i class="fa fa-search search-icon"></i>
                                </a>
            </div>
            <div class="right-head" style="text-align: right">
                FIO main user
                <div class="user">

                    <i class="fa fa-user fa-fw" style=" font-size: xxx-large;"></i>

                </div>
            </div>
        </div>

    </div>
    <div class="subhead">
        <div style="font-weight: bolder;
    font-size: xx-large;">Заказчики
        </div>
        <div class="subhead_subsection">

            <div class="search">
                <a href="#" class="search-btn">
                    <i class="fa fa-search search-icon"></i>
                </a>
                <input type="search" class="search-field" placeholder="Поиск" style="all: unset;">
            </div>

            <div class="" style="width: 100%">
                <input type="button" class="button_add" value="+ Добавить создать">
            </div>
        </div>
    </div>
    <div class="main">
{#    Весь контент сюда    #}
        <article class="content">
            <table id="tableCustomers">
                {#         https://www.dev-notes.ru/articles/frontend/simple-pagination-html-css-javascript/#}
                <thead id="theadTableCustomers">
                <tr>
                </tr>
                </thead>
                <tbody id="tableContent">
                </tbody>
            </table>
        </article>
    </div>
</div>

</body>
<script>


    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOMContentLoaded page')
        getCompanyList()
    })

    /**
    getCompanyList - функция для получения списка компаний

        @param id_company - идентификатор компании из Postgress;
        @param page - запрашиваемая страница пагинации;
        @param size - количество компаний на одной странице;
    **/
    async function getCompanyList(id_company = '', page = 0, size = 5) {
        let URL = `/company/getCompany?page=${page}&size=${size}`
        check_user = await fetch(URL, {
            headers: {
                Accept: 'application/json',
                "Authorization": getCookieValue("Authorization")
            },
        });
        let responseText = await check_user.text();
        {#console.log('response', responseText)#}
        let arrayCustomers = JSON.parse(responseText)
        console.log(arrayCustomers)
        {#console.log(arrayCustomers[arrayCustomers.length - 1].total)#}

        let tempTr = '';
        document.getElementById('tableContent').replaceChildren();
        for (let i = 0; i < arrayCustomers.length - 1; i++) {
            tempTr = document.createElement('tr');
            let tempTd = ''
            for (let j in arrayCustomers[i]) {
                tempTd = document.createElement('td');
                {#console.log(arrayCustomers[i][j])#}
                tempTd.textContent = arrayCustomers[i][j];
                tempTr.append(tempTd)
            }
            document.getElementById('tableContent').append(tempTr)

        }

        if (document.getElementById('pagination')==null) {
            let p2 = ''
            for (let i in arrayCustomers[0]) {
                p2 = document.createElement('td');
                p2.textContent = i;
                document.getElementById('theadTableCustomers').childNodes[1].append(p2);
                {#console.log('тут', i)#}
            }
            paginationBut(arrayCustomers[arrayCustomers.length - 1].size, arrayCustomers[arrayCustomers.length - 1].total)

        }
    }

    function paginationBut(itemsPerPage, totalPages) {
        const content = document.querySelector('.content');
        {#const itemsPerPage = 5;#}
        let currentPage = 0;
        const items = Array.from(content.getElementsByTagName('tr')).slice(1);

        function showPage(page) {
            console.log('PAGE', page)
            getCompanyList('', page, itemsPerPage)

            /*const startIndex = page * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            items.forEach((item, index) => {
                item.classList.toggle('hidden', index < startIndex || index >= endIndex);
            })*/
            updateActiveButtonStates();
        }

        function createPageButtons() {
            {#const totalPages = Math.ceil(items.length / itemsPerPage);#}
            const paginationContainer = document.createElement('div');
            const paginationDiv = document.body.appendChild(paginationContainer);
            paginationContainer.classList.add('pagination');
            paginationContainer.setAttribute('id', 'pagination');

            // Add page buttons
            for (let i = 0; i < totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i + 1;
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    showPage(currentPage);
                    updateActiveButtonStates();
                });

                content.appendChild(paginationContainer);
                paginationDiv.appendChild(pageButton);
    }
        }

        function updateActiveButtonStates() {
            const pageButtons = document.querySelectorAll('.pagination button');
            pageButtons.forEach((button, index) => {
                if (index === currentPage) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }
        createPageButtons(); // Call this function to create the page buttons initially
        showPage(currentPage);
    }

</script>
</html>

