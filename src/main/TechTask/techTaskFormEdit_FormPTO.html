<div class="panel-body">
    <div class="row">
        <div class="col-lg-12">
            <form role="form" id="formFrame">

                <div class="form-group">
                    <label>Добавление раздела</label>
                    <select class="form-control form-group" id="select_one">
                        <option value="0">Выбирите значение</option>
                        <option value="1">Устройство декоративного бассейна. Парк Швейцария</option>
                        <option value="2">3</option>
                        <option value="3">4</option>
                        <option value="4">5</option>
                    </select>
                    <button id='add_razdel' type="button" class="btn btn-primary"> Добавить раздел</button>
                    <button id='del_razdel' type="button" class="btn btn-primary"> Удалить раздел</button>


                </div>
                <div class="style_table table-responsive" id='style_table' style="display:none;">
                    <table class="first iksweb" id="first_table">

                    </table>
                </div>
            </form>
        </div>
    </div>
</div>

<script>

{# хранить значения value инпутов в массиве??? при сохранении формы, например.
var inputValues = [];
inputValues.push(document.getElementById('input1').value);
inputValues.push(document.getElementById('input2').value);#}


    const table = document.getElementById('first_table');

    let coll_table = 1;
    let arr_coll_table = [1];
    let id_count = 1;
    let arr_id_count = [1];
    document.getElementById('add_razdel').onclick = function () {
        let e = document.getElementById("select_one");
        let value = e.value;
        let text = e.options[e.selectedIndex].text;
        document.getElementById("style_table").style.display = "block";
        //document.getElementById('first_table_span').innerText = text;
        let control = true;

        for (let j of arr_coll_table){
        if (j < coll_table && document.getElementById('first_table_span_'+ j).innerText == text){
            console.warn('!!! j= ' + j);
            control = false;
            alert('раздел есть ' + control)
        }
        }
        if (control){
        $("#first_table").append(`<tbody id = "tbody_${coll_table}">
                        <tr style="background-color: #fce1b3">
                            <td colspan="7"><span id="first_table_span_${coll_table}" ></span></td>
                        </tr>
                        <tr>
                            <td>№</td>
                            <td rowspan="2">Наименование</td>
                            <td colspan="4">Стоимость</td>
                            <td width="10%">Добавить вид работ
                                <button class="editbtn" id='button_table_1_${coll_table}' type="button">+</button>
                            </td>
                        </tr>
                        <tr>
                            <td>п/п</td>
                            <td>Ед.изм.</td>
                            <td>Кол-во</td>
                            <td>Цена</td>
                            <td>Всего</td>
                            <td>Добавить значение
                                <button class="editbtn" id="button_table_2_${coll_table}" type="button">+</button>
                            </td>
                        </tr>
                        </tbody>`)

        document.getElementById('first_table_span_'+ coll_table).innerText = text;

        coll_table++;
        arr_coll_table.push(coll_table)
        }
    }

    table.addEventListener('click', function handleClick(event) {

        if (event.target.type == 'button' && (event.target.id.slice(0,event.target.id.lastIndexOf('_')) == 'button_table_2' || event.target.id.slice(0,event.target.id.lastIndexOf('_')) == 'button_table_1')){
            let str = event.target.id.slice(event.target.id.lastIndexOf('_')+1, event.target.id.length);
            addLine(str, event.target.id, id_count);
            id_count++;
            arr_id_count.push(id_count);
        } else if (event.target.type == 'button' && event.target.id.slice(0,event.target.id.lastIndexOf('_')) == 'delbtn'){
            {#alert('delbtn');#}
            delLine(event.target.id);
        } else if (event.target.type == 'button' && event.target.id == 'del_razdel'){

            alert('Удалить раздел: ')
        }
    });

    function addLine(id_table, cel, id_create) {
        console.warn(id_table)
        let tbody = document.getElementById(`tbody_${id_table}`)
        console.log('tbody = ' + tbody)
         let arrIdTable = [];
                $(`#tbody_${id_table} tr`).each(function () {
                    arrIdTable.push(this.id);
                });
                arrIdTable.splice(0, 3)
                console.warn(arrIdTable, arrIdTable.length);

        if (cel.slice(0,cel.lastIndexOf('_')) == 'button_table_2'){

            let parentTbody = document.getElementById(`tbody_${id_table}`);
            console.warn(parentTbody)

            $(parentTbody).append(`<tr id = "stroka${id_create}"><td contenteditable="false" id = "nn${id_create}">${arrIdTable.length + 1}</td>
<td contenteditable="true" style="padding: 0;"><input id = 'input_${id_create}' type="text" name="example" list="exampleList"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);"><datalist id="exampleList"><option value="A"><option value="B"></datalist></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td><button type = "button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_${id_create}"></button></td></tr>`);

        } else if (cel.slice(0,cel.lastIndexOf('_')) == 'button_table_1'){
            let parentTbody = document.getElementById(`tbody_${id_table}`);
            console.warn(parentTbody)
            $(parentTbody).append(`<tr id = "stroka${id_create}"><td contenteditable="false" id = "nn${id_create}">${arrIdTable.length + 1}</td> <td contenteditable="true" style="padding: 0;"><input id = 'input_${id_create}' type="text" name="example" list="exampleList_vid_rabot"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);"><datalist id="exampleList_vid_rabot"><option value="Стоимость работ"><option value="Стоимость материала"></datalist></td><td colspan="3" contenteditable="true"></td><td contenteditable="true"></td><td><button type = "button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_${id_create}"></button></td></tr>`);
        }

    }

    function delLine(cel){
        console.warn('cel= ' + cel)
        let id_table = document.getElementById(cel).parentElement.parentElement.parentElement.id;
        id_table = id_table.slice(id_table.lastIndexOf('_')+1,id_table.length)
        console.log('tbody = ' + id_table)
        let id_del = cel.slice(cel.lastIndexOf('_')+1, cel.length)
        console.warn(id_del)
        console.warn(document.getElementById('stroka' + id_del))
                document.getElementById(`stroka${id_del}`).remove()
        let arrCountStrok = [];
        $(`#tbody_${id_table} tr`).each(function () {
                    arrCountStrok.push(this.id);
                });
        arrCountStrok.splice(0, 3);
                console.warn(arrCountStrok, arrCountStrok.length);

                // получаю массив всех ID строк из таблицы first_table. splice отрезает id маски - 3 строки.
                let arrIdTable = [];

                $(`#tbody_${id_table} tr`).each(function () {
                    arrIdTable.push(this.id);
                });
                arrIdTable.splice(0, 3)
                console.warn(arrIdTable);
                // обновляю отображение номера строки в первом столбце по ID = 'nn'+${count_table}
                for (let i of arrIdTable) {
                    document.getElementById('nn' + i.slice(6, i.length)).innerText = arrIdTable.indexOf(i) + 1;
                }
    }

    document.getElementById('del_razdel').onclick = function () {
        let e = document.getElementById("select_one");
        let value = e.value;
        let text = e.options[e.selectedIndex].text;

        console.warn(arr_coll_table)
        for (let i of arr_coll_table){
            if(i < coll_table && document.getElementById('first_table_span_'+ i).innerText == text){
                console.log(i);
                let del_tbody = document.getElementById('first_table_span_'+ i);
                del_tbody = del_tbody.parentElement.parentElement.parentElement;
                console.warn(del_tbody);
                del_tbody.remove();
                arr_coll_table.splice(arr_coll_table.indexOf(i) , 1);
                console.warn(arr_coll_table);
                break;
            } else if (i == coll_table){
             alert(' нет раздела для удаления ')
             }
        }


    }


</script>
