{#        <div class="panel-body">#}
<div class="row">
    {#                <div class="col-lg-12">#}
    <form role="form" id="formFrame">
        <div class="tabsCalcylator">
            <div class="tabsCalcylator__head">
                <div class="tabsCalcylator__caption" data-tab="enginer_pto" id="zaglav_user_name">Пользователь</div>
{#                <div class="tabsCalcylator__caption" data-tab="supplier">Снабжение</div>#}
{#                <div class="tabsCalcylator__caption" data-tab="boss_enginer_pto">Главный инженер</div>#}
{#                <div class="tabsCalcylator__caption" data-tab="boss">Директор</div>#}
                {#                                    <div class="tabs__caption" data-tab="about">Главный Инженер</div>#}
                {#                                    <div class="tabs__caption" data-tab="about">Руководитель</div>#}
            </div>
            <div class="tabsCalcylator__body">
                <div class="tabsCalcylator__content" data-tab="enginer_pto">

                    <div class="panel panel-default">
                        {% include "TechTask/techTaskFormEdit_FormPTO.html" %}

                        <!-- /.panel-body -->
                    </div>

                </div>
{#                <div class="tabsCalcylator__content" data-tab="supplier">#}
{#                    <div class="panel panel-default">#}
{##}
{#                        {% include "TechTask/techTaskFormEdit_FormKP.html" %}#}
{##}
{#                        <!-- /.panel-body -->#}
{#                    </div>#}
{#                </div>#}
{#                <div class="tabsCalcylator__content" data-tab="boss_enginer_pto">#}
{#                    <div class="panel panel-default">#}
{##}
{#                        {% include "TechTask/techTaskFormEdit_FormBossEngierPto.html" %}#}
{##}
{#                        <!-- /.panel-body -->#}
{#                    </div>#}
{#                </div>#}
{#                <div class="tabsCalcylator__content" data-tab="boss">#}
{#                    <div class="panel panel-default">#}
{##}
{#                        {% include "TechTask/techTaskFormEdit_FormBoss.html" %}#}
{##}
{#                    </div>#}
{##}
{#                </div>#}


            </div>
        </div>
        <div class="row col-lg-12">
            <div class="panel panel-default" id="panel_1" style="display:none;">
            <div class="panel-heading">
            <div class="form-group">

                <label id="saveTable_description_label" style="display:none;">Описание изменений 20 символов</label>
                <input id="saveTable_description" class="form-control" style="display:none;">
            </div>
            <div class="form-group">
                <button id="saveTable" class="btn btn-primary" style="display:none;">Сохранить изменения таблицы</button>
            </div>
            <div class="form-group">
                <label id="versionTable_label" style="display:none;">Список версии</label>
                <select id="versionTable" class="form-control" style="display:none;">
                </select>
            </div>
            </div>
            </div>

            <div class="panel panel-default" id="panel_2" style="display:none;">

                                <div  id="div_Save_excel" >
                                    <button id="Save_excel" class="btn btn-primary">Сохранить в excel</button>

</div>
<script>
 $(document).ready(function(){

         $(document).on('focusin', 'textarea[name=textAreaComment]', function () {
              $(this).hide();
              {#$(this).style = "display: none;"#}
              textarea = $(this).closest('tr').find('input[name=textInputComment]');
              textarea.show().focus().val($(this).val());//show, focus and get value from input
         });

         $(document).on('focusout', 'input[name=textInputComment]', function () {
              $(this).hide();
              textarea = $(this).closest('tr').find('textarea[name=textAreaComment]');
              textarea.show().val($(this).val());//get value from textarea
               //$('textarea').css("height", $("textarea").prop("scrollHeight"))
               console.log("$(this).closest('tr').clientHeight")
               console.log($(this).closest('tr').clientHeight)
              textarea[0].style.height=`${textarea[0].scrollHeight}px`


              {#this.style.height = `${this.scrollHeight}px`;#}
         });
  });
{#window.onload = function(){#}
{#    console.log('onload')#}
{#    console.log(first_table.innerHTML)#}
{#//}#}

toggleCheckbox.onclick = function(){
console.log(toggleCheckbox.checked)
if (toggleCheckbox.checked){
    document.getElementById('legeng_story').style.display = 'block'
    //     editor_ADMIN  editor_ENGINEER  editor_MAIN_ENGINEER   editor_BOSS   editor_SUPPLIER
    $('.editor_ADMIN').css("background","#c96eff")
    $('.editor_ENGINEER').css("background","#f568d4")
    $('.editor_MAIN_ENGINEER').css("background","#267a55")
    $('.editor_BOSS').css("background","#ffe271")
    $('.editor_SUPPLIER').css("background","#59d5ff")


} else {
    document.getElementById('legeng_story').style.display = 'none'
    table_roles(JSON.parse({{roles_user|tojson|safe}} )[0])
    console.log('JSON.parse(responseText).id_actual_table')
    //console.log(JSON.parse(responseText).id_actual_table)
    sravnenie(false)
}
}

async function status_table(state,check=true){

    let response = await fetch('/techTask/SetWorkingTable_NameTechTask', {
      method: 'POST',
      headers: {
            'Content-Type': 'application/json',
            Accept: 'application/json',
            "Authorization": getCookieValue("Authorization")
      },
      body: JSON.stringify({"NameTechTask": {{getTechTaskName.NameTechTask|tojson|safe}},"state": state})
    });
            let responseText = await response.text();
            if (response.status==200){

                if (check && JSON.parse(responseText).id_actual_table!=etalon_ID){
                    showToast('Появилась новая актуальная версия таблицы, необходимо обновить страницу' , 'warning' , 10000)

                }

                return responseText
            }
            else{
                return {"state":"error","user":"","id_actual_table":""}

            }
}


let stopInterval;
async function upTableTime(n=5,state=true){
    console.log(n)
    console.log(state)
     clearInterval(stopInterval);
    if (!state) return

    // Отправляем в таблицу True
    let dateNow = new Date();
    dateNow.setMinutes(dateNow.getMinutes()+n)
    console.log(dateNow)

    state_table=JSON.parse(await status_table(true))
    if (state_table.state){

    stopInterval = setInterval(()=>{
        let dateTimeOut = new Date()
        if (((dateNow - dateTimeOut)/60/1000).toFixed()==0){
            console.log('timeOut вышел: ' + dateNow)
            save_table_function(description='Автосохранение')
            clearInterval(stopInterval)
            // Отправляем в таблицу false
        } else {
            console.log('date: ' + dateTimeOut.getHours() +':'+ dateTimeOut.getMinutes())
        }
    }, 1000)
}
    else{
        if (state_table.state!="error"){
        showToast(`Актуальная версия таблицы редактируется пользователем ${state_table.user} внесенные изменения сохраняться в другой версии ` , 'warning' , 5000)

        }else{
        showToast(`Ошибка сервера ` , 'error' , 5000)

        }

    }
}
 //upTableTime()


        function createModal(arr){
        let blockDiv = document.createElement("div");
        blockDiv.setAttribute('id', 'my_modal');
        blockDiv.setAttribute('class', 'popup');
        let blockStrok = document.createElement("div");
        let stroka = ' Отсутвуют строки: ';

        console.warn('собираю строку')
        console.warn(arr)
            for (let i = 0;i<arr.length;i++){
                stroka += arr[i] + '; ';
            }
        stroka += ' количество отсутвующих строк: ' + arr.length;
        blockDiv.style.display = 'block';

        blockStrok.innerHTML = stroka;
        blockDiv.appendChild(blockStrok);

        blockDiv.innerHTML+=`<div class="btn-container" style="text-align:center; margin: 10px;">

                                                            <button id="yes-btn" class="popup__button" onclick="document.getElementById('my_modal').remove()"'>
                                                                Ок
                                                            </button>

                                                        </div>`

        document.body.appendChild(blockDiv)
        }




        window.onresize = function(event) {
            resize_div_for_table()

        };
        console.warn('roles:')
        console.warn({{roles_user|tojson|safe}})//==`"[\\"ENGINEER\\"]"`
        console.warn({{roles_user|tojson|safe}}==`["ENGINEER"]`)//
        let name_roles ={
        '["ENGINEER"]':'Инженер ПТО',
        '["ADMIN"]':'Admin',
        '["BOSS"]':'Директор',
        '["SUPPLIER"]':'Снабжение',
        '["MAIN_ENGINEER"]':'Главный инженер',
        }
        document.getElementById('zaglav_user_name').innerText = name_roles[{{roles_user|tojson|safe}}]


                                    document.getElementById('Save_excel').onclick = async function () {
                                       event.preventDefault();

                                        const xhr = new XMLHttpRequest(); // создаем объект XMLHttpRequest
                                        xhr.open('POST', '/BaseFile/reports'); // указываем метод и URL сервера, куда будет отправлен файл
                                        xhr.setRequestHeader("Authorization", getCookieValue("Authorization")); // указываем метод и URL сервера, куда будет отправлен файл
                                        xhr.setRequestHeader("Accept", "application/json"); // указываем метод и URL сервера, куда будет отправлен файл
                                        xhr.setRequestHeader("Content-Type", "application/json"); // указываем метод и URL сервера, куда будет отправлен файл
                                        xhr.send(JSON.stringify({"tables": $('#table_pto')[0].innerHTML}));
                                        xhr.onload = function () {
                                            if (xhr.status == 200) {
                                                a = document.createElement('a')
                                                a.href = 'javascript:void(0);'
                                                a.target = "_blank"
                                                a.onclick = function () {
                                                    event.preventDefault();
                                                    downloadFileFromURL('/BaseFile/download-file/' + xhr.response.replaceAll('"', ""), "file_name.xls")
                                                }
                                                a.innerText = "file_name.xls"
                                                a.click()
                                            }
                                        }
                                   }


                                    document.getElementById("Otpravka_roles_text").onkeypress = function (e) {
                                        var chr = String.fromCharCode(e.which);
                                        if ("&".indexOf(chr) != -1)
                                            return false;
                                    };
                                    document.getElementById('Otpravka_roles_button').onclick = async function () {
                                        event.preventDefault();
                                        valid = true
                                        if (document.getElementById('Otpravka_roles_text').value == "") {
                                            document.getElementById('Otpravka_roles_text').setAttribute("required", true)

                                            valid = false
                                        }
                                        if (document.getElementById('DateEndWork').value == "") {
                                            document.getElementById('DateEndWork').setAttribute("required", true)


                                        }
                                        if (valid == false) {
                                            return
                                        }

                                        console.log(document.getElementById('Otpravka_roles_text').value)
                                        user = []
                                        user.push(document.getElementById('Otpravka_roles').value)
                                        if (document.getElementById('Type').value=="username"){
                                           URL= `/userprofile/createUserTask?name=<a href="${window.location.href}"> {{getTechTaskName.NameTechTask|tojson|safe}}</a> Комментарий к задаче: ${document.getElementById('Otpravka_roles_text').value}&user_executor=${JSON.stringify(user)}&status=%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B0&result=&target_date=${document.getElementById('DateEndWork').value}&notification_holder=false&notification_executor=true&connection=${JSON.stringify({"TechTask":{{getTechTaskName.id|tojson|safe}}})}&priority=${document.getElementById('priority').value}`
                                        }else{

                                           URL= `/userprofile/createUserTaskRoles?name=Ссылка на ТЗ <a href="${window.location.href}"> {{getTechTaskName.NameTechTask|tojson|safe}}</a> Комментарий к задаче: ${document.getElementById('Otpravka_roles_text').value}&user_executor=${JSON.stringify(user)}&status=%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B0&result=&target_date=${document.getElementById('DateEndWork').value}&notification_holder=false&notification_executor=true&connection=${JSON.stringify({"TechTask":{{getTechTaskName.id|tojson|safe}}})}&priority=${document.getElementById('priority').value}`
                                        }
                                        res = await fetch(URL, {
                                            method: "GET",
                                            headers: {
                                                Accept: 'application/json',
                                                'Content-Type': 'application/json',
                                                "Authorization": getCookieValue("Authorization")
                                            },
                                            {#body: JSON.stringify({})#}
                                        });
                                        console.log("res.status", res.status)
                                        if (res.status == 200) {
                                            console.log(res.status)
                                            showToast('Задача сформирована' , 'info' , 5000)
                                            {#window.location.href ="/main/techTask.html"#}
                                        } else {
                                            showToast("Ошибка", "error", 5000);

                                        }
                                    }
                                    document.getElementById('Otpravka_roles').onchange = async function (event) {
                                        document.getElementById("Opisanie_forms").style.display = "block";
                                        document.getElementById("button_forms").style.display = "block";

                                    }
                                    document.getElementById('Type').onchange = async function (event) {
                                        event.preventDefault();
                                        if (!etalon_table){
                                        //($('#first_table')[0].innerHTML.replaceAll('display:none','display:table-cell') != etalon_table && !($('#first_table')[0].innerHTML == '\n\n                        ' && etalon_table=='')){
                                            showToast('Необходимо сохранить изменения в таблице' , 'danger' , 5000)
                                        }

                                        removeOptions(document.getElementById('Otpravka_roles'));
                                        var opt = document.createElement('option');
                                        opt.innerHTML = "<option disabled selected value> --Выберите-- </option>"
                                        document.getElementById('Otpravka_roles').appendChild(opt);
                                        if ($(this).val() == "roles") {
                                            document.getElementById("Opisanie_forms").style.display = "none";
                                            document.getElementById("button_forms").style.display = "none";
                                            document.getElementById("Otpravka_roles_forms").style.display = "block";



                                            values = {{ all_roles|tojson|safe }}
                                            for (value of Object.keys(values)) {
                                                console.log("value", value)

                                                var opt = document.createElement('option');
                                                opt.value = value
                                                opt.innerHTML = values[value]
                                                document.getElementById('Otpravka_roles').appendChild(opt);


                                            }
                                        }

                                        if ($(this).val() == "username") {
                                            document.getElementById("Otpravka_roles_forms").style.display = "block";


                                            values = {{ all_user|tojson|safe }}
                                            for (value of Object.keys(values)) {
                                                console.log("value", value)
                                                if (window.my_UserPfofile.my_username != value) {

                                                var opt = document.createElement('option');
                                                opt.value = value
                                                opt.innerHTML = values[value]
                                                document.getElementById('Otpravka_roles').appendChild(opt);


                                            }
                                            }
                                        }
                                    }


</script>

        </div>

            </div>
{#            </div>#}


    </form>
    </div>
    {#                </div>#}




<script>



function formulaTable(furm){
  let arr_key = ['Tab','Shift','Enter']
let calculate = function(n) {
    let expr = n.abbr.replaceAll(',','.')
      , ret  = expr;
    if (expr) {
      try {
        ret = eval(expr);
      } catch(e) {
        ret = 'Syntax error in equation!';
      }
    }
    console.log('return ', ret)
    return ret;
  };

  furm.addEventListener('click', function(n) {
        console.log('click ')
        n = n.target
        if (n.innerText != n.abbr){
        n.innerText = n.abbr
        }

      })
      furm.addEventListener("focusout", (n) => {
        console.log('focusout ')
        n = n.target
        {#console.warn(n)#}
        if (n.innerText == n.abbr){
        !isNaN(calculate(n))?n.innerText = (calculate(n)).toFixed(2):n.innerText = (calculate(n));

        }
      })
furm.addEventListener('keyup', function(event) {
      //console.log('keyup ')
      let n = this;
      if (arr_key.indexOf(event.key)==-1){
      console.log('не в массиве ' + arr_key.indexOf(event.key))
      n.abbr = n.innerText;
      } else if (event.key == 'Enter' ){
          event.preventDefault();
          console.log('enter')
          n.innerText = (calculate(n)).toFixed(2);
          n.blur();
      } else if(arr_key.indexOf(event.key)>-1){
        if (n.innerText != n.abbr){
        console.log('произошло')
        event.preventDefault();
        console.log(event.key)
        n.innerText = n.abbr;
        }
      }
})
}



    document.addEventListener('DOMContentLoaded', () => { // Структура страницы загружена и готова к взаимодействию

        let elem_obj = {}
        elem_obj.TechTaskProject = JSON.stringify(window.vlozheniya)


        const tabsCalcylator = () => { // объявляем основную функцию для вкладок, чтобы вся логика была в одном месте
            const head = document.querySelector('.tabsCalcylator__head') // ищем элемент с кнопками и записываем в константу
            const body = document.querySelector('.tabsCalcylator__body') // ищем элемент с контентом и записываем в константу

            const getActiveTabName = () => { // объявляем функцию для получения названия активной вкладки
                console.warn('!!!')
                console.warn(head.querySelector('.tabsCalcylator__caption_active').dataset.tab)

                console.log("table_supplier",document.getElementById("table_supplier"))
                console.log("first_tablefirst_table",document.getElementById("first_table"))

                {#if (head.querySelector('.tabsCalcylator__caption_active').dataset.tab == 'enginer_pto'){#}
                {#    document.getElementById("table_pto").appendChild(document.getElementById("first_table"));#}
                {#    if ({{roles_user|tojson|safe}} == `["ENGINEER"]`) {#}
                {#      //$('.pto').style.display = 'none'#}
                {#      //$('.pto').attr("style", "display:none")#}
                {#        $('.pto').css("display", "none");#}
                {#    } else {#}
                {#        $('.pto').css("display", "table-cells");#}
                {#       // $('.pto').style.display = 'table-cell'#}
                {#      //$('.pto').attr("style", "display:table-cell")#}
                {#    }#}
                {##}
                //}
                {#if (head.querySelector('.tabsCalcylator__caption_active').dataset.tab == 'supplier'){#}
                {#    document.getElementById("table_supplier").appendChild(document.getElementById("first_table"));#}
                {#    $('.pto').attr("style", "display:table-cell");#}
                //}
                {#if (head.querySelector('.tabsCalcylator__caption_active').dataset.tab == 'boss'){#}
                {#    document.getElementById("table_boss").appendChild(document.getElementById("first_table"));#}
                {#    $('.pto').attr("style", "display:table-cell");#}
                //}
                {#if (head.querySelector('.tabsCalcylator__caption_active').dataset.tab == 'boss_enginer_pto'){#}
                {#    document.getElementById("table_boss_enginer_pto").appendChild(document.getElementById("first_table"));#}
                {#    $('.pto').attr("style", "display:table-cell");#}
                //}


                {#    $('#first_table').remove();#}
                {#    #}
                {##}
                //}
                return head.querySelector('.tabsCalcylator__caption_active').dataset.tab // возвращаем значение data-tab активной кнопки
            }

            const setActiveContent = () => { // объявляем функцию для установки активного элемента контента
                if (body.querySelector('.tabsCalcylator__content_active')) { // если уже есть активный элемент контента
                    body.querySelector('.tabsCalcylator__content_active').classList.remove('tabsCalcylator__content_active') // то скрываем его
                }
                body.querySelector(`[data-tab=${getActiveTabName()}]`).classList.add('tabsCalcylator__content_active') // затем ищем элемент контента, у которого значение data-tab совпадает со значением data-tab активной кнопки и отображаем его
            }

// проверяем при загрузке страницы, есть ли активная вкладка
            if (!head.querySelector('.tabsCalcylator__caption_active')) {  // если активной вкладки нет
                head.querySelector('.tabsCalcylator__caption').classList.add('tabsCalcylator__caption_active') // то делаем активной по-умолчанию первую вкладку
            }

            setActiveContent(getActiveTabName()) // устанавливаем активный элемент контента в соответствии с активной кнопкой при загрузке страницы

            head.addEventListener('click', e => { // при клике на .tabs__head

                const caption = e.target.closest('.tabsCalcylator__caption') // узнаем, был ли клик на кнопке
                if (!caption) return // если клик был не на кнопке, то прерываем выполнение функции
                if (caption.classList.contains('tabs__caption_active')) return // если клик был на активной кнопке, то тоже прерываем выполнение функции и ничего не делаем

                if (head.querySelector('.tabsCalcylator__caption_active')) { // если уже есть активная кнопка
                    head.querySelector('.tabsCalcylator__caption_active').classList.remove('tabsCalcylator__caption_active') // то удаляем ей активный класс
                }

                caption.classList.add('tabsCalcylator__caption_active') // затем добавляем активный класс кнопке, на которой был клик

                setActiveContent(getActiveTabName()) // устанавливаем активный элемент контента в соответствии с активной кнопкой
            })
        }

        tabsCalcylator() // вызываем основную функцию

    })

//onbeforeunload   onunload
window.onbeforeunload = function() {
    if (!etalon_table)
    //($('#first_table')[0].innerHTML.replaceAll('display:none','').replaceAll('readonly="readonly"','').replaceAll('true','').replaceAll('false','').replaceAll('display:table-cell','') != etalon_table && !($('#first_table')[0].innerHTML == '\n\n                        ' && etalon_table==''))
  return "Данные не сохранены. Точно перейти?";
};

//setTimeout(function (name) {
//  alert(`Привет, ${name}!`);
//}, 3000, 'Василий');

function sravnenie(modal=true){
    //let tableSrav = document.createElement(etalon_html_table)
    let tagForTable = document.createElement("table");
    let divtagForTable = document.createElement("div");
    divtagForTable.appendChild(tagForTable)
    tagForTable.innerHTML = etalon_html_table;
    divtagForTable.setAttribute('id', 'idSravnenie');
    divtagForTable.setAttribute('style', 'display: none');
    document.body.appendChild(divtagForTable)
    let stroki = []
    console.log('etalon:')
        let temp2 = $("#idSravnenie tr[id ^='stroka_']");
        {#console.log(temp);#}
        for (let key = 0; key<temp2.length; key++) {
            if ($("#first_table")[0].innerHTML.indexOf(temp2[key].id)==-1){
                stroki.push(temp2[key].id)
            }
            console.log(temp2[key])

        }
        console.log('нет строк: '+stroki)
        if (stroki.length>0 && modal){
            createModal(stroki);
        } else {console.log('все есть')}


    console.log('my table:')
    let temp = $("#first_table tr[id ^='stroka_']");
    {#console.log(temp);#}

    for(let i = 0; i<temp.length;i++){
    console.log('i in for:'+i)
     if (etalon_html_table.indexOf(temp[i].id)!=-1){
            console.log('i in IF:'+i)
            console.log('ID== '+ temp[i].id)
            console.log('temp ')
            console.log(temp)

        let tempStr = $(`#idSravnenie tr[id =${temp[i].id}]`)[0];
        if(temp[i].childNodes.length==tempStr.childNodes.length){
            for (let j = 0;j<temp[i].childNodes.length;j++){
                if (temp[i].childNodes[j].localName=='td'){
                   if(temp[i].childNodes[j].innerHTML!=tempStr.childNodes[j].innerHTML){
                        if(temp[i].childNodes[j].innerHTML.indexOf('type="text"')==-1){
                            temp[i].childNodes[j].style.backgroundColor='#ff9090'
                        } else if (temp[i].childNodes[j].childNodes[1].childNodes[1].value != tempStr.childNodes[j].childNodes[1].childNodes[1].value){
                                     temp[i].childNodes[j].childNodes[1].childNodes[1].style.backgroundColor='#ff9090'
                                }
                   }
                }
            }
        } else {
                console.log('строка ' + temp[i].id + ' в другом разделе')
                console.log(i)
                console.log(temp[i].childNodes)
                      for (let j = 0;j<temp[i].childNodes.length;j++){
                            if (temp[i].childNodes[j].localName=='td'){

                                    if(temp[i].childNodes[j].innerHTML.indexOf('type="text"')==-1){
                                        temp[i].childNodes[j].style.backgroundColor='#ff9090'
                                    } else {
                                                 temp[i].childNodes[j].childNodes[1].childNodes[1].style.backgroundColor='#ff9090'
                                            }

                            }
                        }
                //temp[i]
            }

     }  else {
     console.log('строка ' + temp[i].id + ' отсутсвует в "Эталоне"')
        for (let j = 0;j<temp[i].childNodes.length;j++){
                            if (temp[i].childNodes[j].localName=='td'){

                                    if(temp[i].childNodes[j].innerHTML.indexOf('type="text"')==-1){
                                        temp[i].childNodes[j].style.backgroundColor='#ff9090'
                                    } else {
                                                 temp[i].childNodes[j].childNodes[1].childNodes[1].style.backgroundColor='#ff9090'
                                            }

                            }
                        }


     }

    }

    console.warn('SRAVNENIE END')
    document.getElementById('idSravnenie').remove()
    //divtagForTable.remove()
}

function removeOptions(selectElement) {
    while (selectElement.options.length > 0) {
        selectElement.remove(0);
    }
}


$('#versionTable').change(async function(){
    id =$(this).val().slice($(this).val().indexOf("{")+1,$(this).val().indexOf("}"))
        console.log($(this).val())
        console.log("id",id)
                removeOptions(document.getElementById('versionTable'));
    document.getElementById('versionTable').blur();
let response = await fetch('/techTask/formPtoGet_id', {
  method: 'POST',
  headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
        "Authorization": getCookieValue("Authorization")
  },
  body: JSON.stringify({"id":id })
});
        let responseText = await response.text();
        console.log("formPtoGet",JSON.parse(responseText))
        if (response.status==200){
         document.getElementById('label_version').innerText="Загруженная версия  -  id{"+JSON.parse(responseText)["id"]+"},Время сохранения:"+JSON.parse(responseText)["create_at"]+",  Описание:"+ (JSON.parse(responseText)["description"]==null?"":JSON.parse(responseText)["description"])+",  Пользователь:"+JSON.parse(responseText)["user_name"];

         Napolneneie(JSON.parse(responseText))
        sravnenie();
        toggleCheckbox.checked = false
        document.getElementById('legeng_story').style.display = 'none'

        }
})


$("#versionTable").on("focus",async function(){

if (!etalon_table) {
//($('#first_table')[0].innerHTML.replaceAll('display:none','').replaceAll('readonly="readonly"','').replaceAll('true','').replaceAll('false','').replaceAll('display:table-cell','') != etalon_table && !($('#first_table')[0].innerHTML == '\n\n                        ' && etalon_table=='')){
            showToast('Несохраненные изменения пропадут' , 'danger' , 5000)
}
removeOptions(document.getElementById('versionTable'));
                var opt = document.createElement('option');
                {#opt.value = JSON.parse(responseText)[i]["id"];#}
                opt.innerHTML =  "<option disabled selected value> Ожидайте </option>"
                document.getElementById('versionTable').appendChild(opt);
    let sum=10
   let response = await fetch('/techTask/formPtoGet_key', {
  method: 'POST',
  headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
        "Authorization": getCookieValue("Authorization")
  },
  body: JSON.stringify({"NameTechTask_key": {{getTechTaskName.NameTechTask|tojson|safe}} , "sum":sum})
});
        let responseText = await response.text();
        console.log("formPtoGet",JSON.parse(responseText))
        if (response.status==200){


            console.log(document.getElementById('versionTable').options[0])
            document.getElementById('versionTable').options[0].innerHTML =  "<option disabled selected value> При выборе подтянется архивная таблица </option>"


            console.log(JSON.parse(responseText))
            max = sum,
            select = document.getElementById('versionTable');

            for (var i = 0; i<JSON.parse(responseText).length; i++){
            console.log("id",JSON.parse(responseText)[i]["id"])
            console.log("description",JSON.parse(responseText)[i]["description"])

                var opt = document.createElement('option');
                {#opt.value = JSON.parse(responseText)[i]["id"];#}
                opt.innerHTML = "id{"+JSON.parse(responseText)[i]["id"]+"},Время сохранения:"+JSON.parse(responseText)[i]["create_at"]+",  Описание:"+ (JSON.parse(responseText)[i]["description"]==null?"":JSON.parse(responseText)[i]["description"])+",  Пользователь:"+JSON.parse(responseText)[i]["user_name"];
                select.appendChild(opt);
            }
        }

})

// функция для запрета enter кроме "Примечание"
$('#first_table').keypress(
  function(event){

    if (event.which == '13' && event.target.className.indexOf(' note')== -1) {
      event.preventDefault();
    }
    etalon_table = false;
    upTableTime();
});
let etalon_html_table = ''
async function Test() {
{#console.log("getTechTaskName",{{getTechTaskName.NameTechTask|tojson|safe}})#}
    let response = await fetch('/techTask/formPtoGet', {
  method: 'POST',
  headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
        "Authorization": getCookieValue("Authorization")
  },
  body: JSON.stringify({"NameTechTask_key": {{getTechTaskName.NameTechTask|tojson|safe}}})
});
        let responseText = await response.text();
        console.log("formPtoGet",JSON.parse(responseText))
        if (response.status==200){
         etalon_ID = JSON.parse(responseText).id
         etalon_html_table = JSON.parse(responseText).value_table
         Napolneneie(JSON.parse(responseText))

         document.getElementById('label_version').innerText="Загруженная версия  -  id{"+JSON.parse(responseText)["id"]+"},Время сохранения:"+JSON.parse(responseText)["create_at"]+",  Описание:"+ (JSON.parse(responseText)["description"]==null?"":JSON.parse(responseText)["description"])+",  Пользователь:"+JSON.parse(responseText)["user_name"];
        }


}
Test()
let etalon_table = true;
console.log("etalon_table",etalon_table)
function Napolneneie(value){

   document.getElementById("first_table").innerHTML=value.value_table
   document.getElementById("table_pto").appendChild(document.getElementById("first_table"));
                    if ({{roles_user|tojson|safe}} == `["ENGINEER"]`) {
                      //$('.pto').style.display = 'none'
                      //$('.pto').attr("style", "display:none")
                        $('.pto').css("display", "none");
                    } else {
                        $('.pto').css("display", "table-cells");
                       // $('.pto').style.display = 'table-cell'
                      //$('.pto').attr("style", "display:table-cell")
                    }

   //etalon_table = true
   //value.value_table.replaceAll('display:none','').replaceAll('readonly="readonly"','').replaceAll('true','').replaceAll('false','').replaceAll('display:table-cell','');
   window.etalon_table=etalon_table

            {#document.getElementById("first_table_supplier").innerHTML=JSON.parse(responseText).value_table#}
            document.getElementById("style_table").style.display = "block";
            document.getElementById("saveTable").style.display = "block";
            document.getElementById("panel_2").style.display = "block";
            document.getElementById("panel_1").style.display = "block";
            document.getElementById("saveTable_description").style.display = "block";
            document.getElementById("saveTable_description_label").style.display = "block";
            document.getElementById("versionTable_label").style.display = "block";
            document.getElementById("Otpravka_roles_label").style.display = "block";
            document.getElementById("Otpravka_roles").style.display = "block";
            document.getElementById("versionTable").style.display = "block";
            document.getElementById("Otpravka_roles_button").style.display = "block";
            document.getElementById("Otpravka_roles_label_comment").style.display = "block";
            document.getElementById("Otpravka_roles_text").style.display = "block";
            {#seach_ID_table(JSON.parse(responseText).value_table);#}
            {#console.log(seach_ID_table('tbody','earthWorks_'))#}

            //let vblsota=window.innerHeight*3/4
            //$('.pto').css("display", "table-cells");

            for_event_tr('tr','stroka_');
            up_obj_global_sum();
            for_total_table();
            {#alert({{roles_user|tojson|safe}})#}
            table_roles(JSON.parse({{roles_user|tojson|safe}} )[0])

             $("button[id ^='del_razdel_']").on("click", function (event){
                 del_func(event)
             })
             {#$("input[id ^='input_']")#}
             event_input($("input[id ^='input_']"))
             //event_all_td();
             {#resize_div_for_table()#}
             let vblsota=window.innerHeight-100
                $(".table-responsive-pto").css("height",`${vblsota}`)

             textarea_value()


}
/**
* textarea_value - функция для наполнения textarea текстом сохраненным в input
*/
function textarea_value(){
    let spisok = $('[id^=textarea_]')
    for(let i=0; i<spisok.length; i++){
        spisok[i].value = $(spisok[i].closest('tr')).find('input[name=textInputComment]')[0].value
    }
}

function event_input(e) {
{#console.log('!@#')#}
{#console.log(e)#}
{#console.log(e.length)#}
    for (let i =0; i<e.length;i++){
    // console.log(e[i])
    let forObj = e[i].id.slice(e[i].id.indexOf('_')+1, e[i].id.lastIndexOf('_'))
    let id_count = e[i].id.slice(e[i].id.lastIndexOf('_')+1)
    {#console.log('count == ', id_count)#}
    {#console.log('forObj == ',forObj)#}
    $(`#div_${forObj}_${id_count}`).delegate(":input", "input", function (e) {
    let type = forObj;
    {#console.warn('!@#this div_ : ', this)#}
    let id_count=e.target.id.slice(e.target.id.lastIndexOf('_')+1)
    {#console.log("stroka = " + " #datalist_" + forObj + "_"+id_count)#}
        var options = $("#datalist_" + forObj + "_"+id_count)[0].options;
        {#console.log("options = " + options)#}
        if (options.length != 0 && options[options.length - 1].value == $(this).val()) {
            {# Определить type по target.id#}

            if ($(this).val().indexOf("Добавить в список \"") != -1) {
                set_setSuggest(type, $(this).val().replace("Добавить в список \"", "").slice(0, -1),`datalist_${forObj}_${id_count}`)
                $(`#input_${forObj}_${id_count}`).val($(this).val().replace("Добавить в список \"", "").slice(0, -1));
            }
            return
        }
        set_options_datalist(type, e.target.value,"datalist_" + forObj +"_"+id_count, 30)

    });

    }
               //
}


 function pereschetTotalSum(){
        let arr_test = []
        $(`#first_table tbody`).each(function () {
                    arr_test.push(this.id.slice(this.id.lastIndexOf('_')+1));
                });
        let arr_index =[]
        for (let i=0; i<arr_test.length; i+=5){
            if (!isNaN(arr_test[i])){
                arr_index.push(arr_test[i])
            }
        }
        console.warn('@@@arr_index = ',arr_index);
        let sum = 0;


        for (i of arr_index){
            if (Object.keys(obj_global_sum).indexOf('ВСЕГО_'+i)!=-1) {
                sum += Number(obj_global_sum['ВСЕГО_'+i])
            }
        }
        obj_global_sum['result_total'] = sum.toFixed(2)
        $(`#result_total`)[0].childNodes[3].childNodes[13].innerText = obj_global_sum['result_total'];
        }

    function pereschetTotalNDS(){
        let arr_test = []
        $(`#first_table tbody`).each(function () {
                    arr_test.push(this.id.slice(this.id.lastIndexOf('_')+1));
                });
        let arr_index =[]
        for (let i=0; i<arr_test.length; i+=5){
            if (!isNaN(arr_test[i])){
                arr_index.push(arr_test[i])
            }
        }
        let sum = 0;

        for (i of arr_index){
            if (Object.keys(obj_global_sum).indexOf('ВСЕГО_НДС_'+i)!=-1) {
                sum += Number(obj_global_sum['ВСЕГО_НДС_'+i])
            }
        }
        $('#result_total')[0].childNodes[5].childNodes[13].innerText = sum.toFixed(2)

    }

 function func_sum_vsego_razdel(elem_stroka){
    let sum = 0;

    let summa_v_itogo = 0;
    let id_for_itogo = elem_stroka.parentElement.parentElement.id.slice(elem_stroka.parentElement.parentElement.id.lastIndexOf('_')+1)

    if (Object.keys(obj_global_sum).indexOf('Накладные_расходы_'+ id_for_itogo)!=-1 && obj_global_sum['Накладные_расходы_'+ id_for_itogo]!= '' && obj_global_sum['earthWorks_costWork_'+ id_for_itogo]!= ''){

        summa_v_itogo += Number(obj_global_sum['Накладные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costWork_'+ id_for_itogo]
        if (document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[3].childNodes[13].innerText != Number(obj_global_sum['Накладные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costWork_'+ id_for_itogo]){
            document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[3].childNodes[13].innerText = (Number(obj_global_sum['Накладные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costWork_'+ id_for_itogo]).toFixed(2)
        }
    }
    if (Object.keys(obj_global_sum).indexOf('Вспомогательные_материалы_'+ id_for_itogo)!=-1 &&obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo]!= '' && obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]!= '') {
        summa_v_itogo += Number(obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]
        if (document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[5].childNodes[13].innerText != Number(obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]){
            document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[5].childNodes[13].innerText = (Number(obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]).toFixed(2)
        }
    }
    if (Object.keys(obj_global_sum).indexOf('Транспортные_расходы_'+ id_for_itogo)!=-1 &&obj_global_sum['Транспортные_расходы_'+ id_for_itogo]!= '' && obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]!= '') {
        summa_v_itogo += Number(obj_global_sum['Транспортные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]
        if (document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[7].childNodes[13].innerText != Number(obj_global_sum['Транспортные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]){
            document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[7].childNodes[13].innerText = (Number(obj_global_sum['Транспортные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]).toFixed(2)
        }
    }
    console.log('summa_v_itogo ', summa_v_itogo.toFixed(2))
    if (summa_v_itogo>=0 && obj_global_sum['earthWorks_Total_'+id_for_itogo]!= ''){
        obj_global_sum['ВСЕГО_'+id_for_itogo] = (Number(obj_global_sum['earthWorks_Total_'+ id_for_itogo]) + Number(summa_v_itogo.toFixed(2))).toFixed(2);
        console.log("присвоение ", obj_global_sum['earthWorks_Total_'+ id_for_itogo],' + ',  Number(summa_v_itogo.toFixed(2)) )

        pereschetTotalSum();
    }
    if (obj_global_sum['earthWorks_Total_'+id_for_itogo]== '0'){
        obj_global_sum['ВСЕГО_'+id_for_itogo] = 0;
        document.getElementById('earthWorks_Total_'+ id_for_itogo).childNodes[9].childNodes[13].innerText = obj_global_sum['ВСЕГО_'+id_for_itogo];

    }


    {#else {
        obj_global_sum['ВСЕГО_'+elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)] = obj_global_sum['earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)]
    }#}
    if (obj_global_sum['ВСЕГО_'+id_for_itogo] != '' && !isNaN(obj_global_sum['ВСЕГО_'+id_for_itogo])) {
        document.getElementById('earthWorks_Total_'+ id_for_itogo).childNodes[9].childNodes[13].innerText = obj_global_sum['ВСЕГО_'+id_for_itogo];
    }

    document.getElementById('earthWorks_Total_'+ id_for_itogo).childNodes[1].childNodes[7].innerText = Number(obj_global_sum['earthWorks_Total_'+ id_for_itogo]).toFixed(2);


 }


 function del_func (event) {
     {#console.log('eventDel_razdel ' + event.target.id.slice(event.target.id.lastIndexOf('_')+1))#}
     if (JSON.parse({{roles_user|tojson|safe}})[0] != 'SUPPLIER') {

         etalon_table = false;
         upTableTime();
         console.log('event!!!')
         console.log(event)
         let zaglav = document.getElementById(`zagolovok_${event.target.id.slice(event.target.id.lastIndexOf('_') + 1)}`);
         zaglav = zaglav.value;
         arr_zaglav.splice(arr_zaglav.indexOf(zaglav), 1);

         let cifra = event.target.id.slice(event.target.id.lastIndexOf('_') + 1);
         arr_coll_table.splice(arr_coll_table.indexOf(Number(event.target.id.slice(event.target.id.lastIndexOf('_') + 1))), 1)
         {#console.log(arr_zaglav);#}

         document.getElementById(`earthWorks_${event.target.id.slice(event.target.id.lastIndexOf('_') + 1)}`).remove()
         document.getElementById(`earthWorks_costWork_${event.target.id.slice(event.target.id.lastIndexOf('_') + 1)}`).remove()
         document.getElementById(`earthWorks_costMaterial_${event.target.id.slice(event.target.id.lastIndexOf('_') + 1)}`).remove()
         document.getElementById(`earthWorks_Special_${event.target.id.slice(event.target.id.lastIndexOf('_') + 1)}`).remove()
         document.getElementById(`earthWorks_Total_${event.target.id.slice(event.target.id.lastIndexOf('_') + 1)}`).remove()

         let arr_test = []
         $(`#first_table tbody`).each(function () {
             arr_test.push(this.id);
         });
         {#console.log('arr_test = ' + arr_test.length)#}
         console.warn(arr_test)
         if (arr_test.length == 1) {
             document.getElementById(`result_total`).remove()
             document.getElementById('style_table').style.display = 'none';
             document.getElementById('panel_1').style.display = 'none';
             document.getElementById('panel_2').style.display = 'none';
             document.getElementById("saveTable").style.display = "none";
             document.getElementById("saveTable_description").style.display = "none";
             document.getElementById("saveTable_description_label").style.display = "none";
             document.getElementById("versionTable_label").style.display = "none";
             document.getElementById("Otpravka_roles_label").style.display = "none";
             document.getElementById("Otpravka_roles").style.display = "none";
             document.getElementById("versionTable").style.display = "none";
             document.getElementById("Otpravka_roles_button").style.display = "none";
             document.getElementById("Otpravka_roles_label_comment").style.display = "none";
             document.getElementById("Otpravka_roles_text").style.display = "none";
         }
         pereschetTotalSum();
         pereschetTotalNDS();
         counterTr();
          let maskTable = $('.maska')
                if ($('*[id^=earthWorks_]').length != 0){
                if (maskTable.length == 0){
                    $('*[id^=earthWorks_]')[0].classList.add('maska');
                } else {
                    maskTable[0].classList.remove("maska")
                    //$('.maska')[0].classList.remove('maska')
                    $('*[id^=earthWorks_]')[0].classList.add('maska');
                }
                }
     }
     resize_div_for_table()
 }


{#let test_temp = '\n\n                    <tbody id="earthWorks_1">\n                    <tr><td colspan="6" style="padding: 0;"><input id="zagolovok_1" style="width: 100%; height: 100%; border:  0;" autocomplete="off" value="123">\n                               </td><td colspan="4"><button id="del_razdel_1" type="button" class="btn-primary"> Удалить раздел</button></td>\n                    </tr>\n                        <tr style="background-color: #fce1b3">\n                            <td rowspan="2">Тех столбец</td>\n                            <td>№</td>\n                            <td rowspan="2">Наименование</td>\n                            <td colspan="4">Стоимость</td>\n                            <td colspan="4">Справочная информация</td>\n                            <td colspan="8">Аналитический блок</td>\n                        </tr>\n\n                        <tr style="background-color: #fce1b3">\n                            <td>п/п</td>\n                            <td>Ед.изм.</td>\n                            <td>Кол-во</td>\n                            <td>Цена</td>\n                            <td>Всего</td>\n                            <td rowspan="1">Тр-затр (чел-дн)</td>\n                            <td rowspan="1">Столбец для анализа</td>\n                            <td rowspan="1"></td>\n                            <td rowspan="1">Примечание</td>\n                            <td>Кол-во</td>\n                            <td>Цена руб-ед</td>\n                            <td>Всего</td>\n                            <td>Тр-затр (чел-дн)</td>\n                            <td>Стоимость дня рабочего</td>\n                        </tr>\n                        </tbody>\n                        <tbody id="earthWorks_costWork_1">\n                        <tr>\n                            <td style="border-right: none;"></td>\n                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>\n                            <td contenteditable="false" id="earthWorks_costWork_addLine_1" style="font-weight: bold; border-left: none;" colspan="4" onmouseover="showButton(event, this)" onmouseout="closeButton(event,this)">\n                            Стоимость работ\n                            <div style="display: none;"><button onclick="addLine(event,this)">addLine</button></div>\n                            </td>\n                            <td contenteditable="false"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        </tr>\n                    <tr id="stroka_1">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_1"></button></td>\n\n\n                            <td contenteditable="false">1</td>\n                            <td contenteditable="false" style="padding: 0;">\n\n                            <div id="div_costWork_1" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costWork_1" type="text"  list="datalist_costWork_1" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWork_1">\n                            </datalist>\n                            </div></td>\n                            <td contenteditable="false" style="padding: 0;">\n                            <div id="div_costWorkEdIzm_1" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_EdIzm_1" type="text"  list="datalist_costWorkEdIzm_1" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWorkEdIzm_1">\n                            </datalist>\n                            </div>\n                            </td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_10">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_10"></button></td>\n\n\n                            <td contenteditable="false">2</td>\n                            <td contenteditable="false" style="padding: 0;">\n\n                            <div id="div_costWork_10" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costWork_10" type="text"  list="datalist_costWork_10" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWork_10">\n                            </datalist>\n                            </div></td>\n                            <td contenteditable="false" style="padding: 0;">\n                            <div id="div_costWorkEdIzm_10" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_EdIzm_10" type="text"  list="datalist_costWorkEdIzm_10" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWorkEdIzm_10">\n                            </datalist>\n                            </div>\n                            </td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_11">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_11"></button></td>\n\n\n                            <td contenteditable="false">3</td>\n                            <td contenteditable="false" style="padding: 0;">\n\n                            <div id="div_costWork_11" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costWork_11" type="text"  list="datalist_costWork_11" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWork_11">\n                            </datalist>\n                            </div></td>\n                            <td contenteditable="false" style="padding: 0;">\n                            <div id="div_costWorkEdIzm_11" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_EdIzm_11" type="text"  list="datalist_costWorkEdIzm_11" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWorkEdIzm_11">\n                            </datalist>\n                            </div>\n                            </td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_12">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_12"></button></td>\n\n\n                            <td contenteditable="false">4</td>\n                            <td contenteditable="false" style="padding: 0;">\n\n                            <div id="div_costWork_12" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costWork_12" type="text"  list="datalist_costWork_12" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWork_12">\n                            </datalist>\n                            </div></td>\n                            <td contenteditable="false" style="padding: 0;">\n                            <div id="div_costWorkEdIzm_12" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_EdIzm_12" type="text"  list="datalist_costWorkEdIzm_12" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWorkEdIzm_12">\n                            </datalist>\n                            </div>\n                            </td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_13">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_13"></button></td>\n\n\n                            <td contenteditable="false">5</td>\n                            <td contenteditable="false" style="padding: 0;">\n\n                            <div id="div_costWork_13" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costWork_13" type="text"  list="datalist_costWork_13" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWork_13">\n                            </datalist>\n                            </div></td>\n                            <td contenteditable="false" style="padding: 0;">\n                            <div id="div_costWorkEdIzm_13" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_EdIzm_13" type="text"  list="datalist_costWorkEdIzm_13" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costWorkEdIzm_13">\n                            </datalist>\n                            </div>\n                            </td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr></tbody><tbody id="earthWorks_costMaterial_1">\n                        <tr>\n                        <td style="border-right: none;"></td>\n                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>\n                            <td contenteditable="false" id="earthWorks_costMaterial_addLine_1" style="font-weight: bold; border-left: none;" colspan="4" onmouseover="showButton(event, this)" onmouseout="closeButton(event,this)">\n                            Стоимость материала\n                            <div style="display: none;"><button onclick="addLine(event,this)">addLine</button></div>\n                            </td>\n                            <td contenteditable="false"></td>\n\n\n                            <td contenteditable="false" colspan="2"> Ед изм расчётные </td>\n\n                            <td contenteditable="false"> Ед изм (М2) для окраски </td>\n\n                            <td contenteditable="true"></td>\n\n                            <td contenteditable="false">Закупка по счету - ед изм расчётные</td>\n                            <td contenteditable="false">Остаток закупки</td>\n                            <td contenteditable="false">ед изм к закупке</td>\n                            <td contenteditable="false">руб-ед</td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false">Счёта</td>\n                            <td contenteditable="false">Срок поставки</td>\n                            <td contenteditable="false">ПРИМЕЧАНИЕ</td>\n                        </tr>\n                    <tr id="stroka_6">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_6"></button></td>\n<td contenteditable="false">1</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_costMaterial_6" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costMaterial_6" type="text"  list="datalist_costMaterial_6" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costMaterial_6">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_7">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_7"></button></td>\n<td contenteditable="false">2</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_costMaterial_7" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costMaterial_7" type="text"  list="datalist_costMaterial_7" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costMaterial_7">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_8">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_8"></button></td>\n<td contenteditable="false">3</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_costMaterial_8" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costMaterial_8" type="text"  list="datalist_costMaterial_8" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costMaterial_8">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_9">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_9"></button></td>\n<td contenteditable="false">4</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_costMaterial_9" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costMaterial_9" type="text"  list="datalist_costMaterial_9" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costMaterial_9">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_14">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_14"></button></td>\n<td contenteditable="false">5</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_costMaterial_14" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costMaterial_14" type="text"  list="datalist_costMaterial_14" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costMaterial_14">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_15">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_15"></button></td>\n<td contenteditable="false">6</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_costMaterial_15" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_costMaterial_15" type="text"  list="datalist_costMaterial_15" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_costMaterial_15">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr></tbody>\n\n                    <tbody id="earthWorks_Special_1">\n                    <tr>\n                    <td style="border-right: none;"></td>\n                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>\n                             <td contenteditable="false" id="earthWorks_Special_addLine_1" style="font-weight: bold; border-left: none;" colspan="4" onmouseover="showButton(event, this)" onmouseout="closeButton(event,this)">\n                            Стоимость спецтехники\n                            <div style="display: none;"><button onclick="addLine(event,this)">addLine</button></div>\n                            </td>\n                            <td contenteditable="false"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n                            <td contenteditable="true"></td>\n\n                            <td contenteditable="false">Стоимость аренды</td>\n                            <td contenteditable="false">Телефон</td>\n                            <td contenteditable="false">Счет</td>\n                            <td contenteditable="false">Срок</td>\n\n                        </tr>\n\n                    <tr id="stroka_2">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_2"></button></td>\n<td contenteditable="false">1</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_Special_2" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_Special_2" type="text"  list="datalist_Special_2" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_Special_2">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_3">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_3"></button></td>\n<td contenteditable="false">2</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_Special_3" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_Special_3" type="text"  list="datalist_Special_3" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_Special_3">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_4">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_4"></button></td>\n<td contenteditable="false">3</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_Special_4" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_Special_4" type="text"  list="datalist_Special_4" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_Special_4">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_5">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_5"></button></td>\n<td contenteditable="false">4</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_Special_5" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_Special_5" type="text"  list="datalist_Special_5" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_Special_5">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_16">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_16"></button></td>\n<td contenteditable="false">5</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_Special_16" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_Special_16" type="text"  list="datalist_Special_16" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_Special_16">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr><tr id="stroka_17">\n<td contenteditable="false"><button type="button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_17"></button></td>\n<td contenteditable="false">6</td>\n                            <td contenteditable="true" style="padding: 0;">\n                            <div id="div_Special_17" style="border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">\n                            <input id="input_Special_17" type="text"  list="datalist_Special_17" value="" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">\n                            <datalist id="datalist_Special_17">\n                            </datalist>\n                            </div>\n                            </td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        <td contenteditable="true"></td>\n                        </tr></tbody>\n\n                     <tbody id="earthWorks_Total_1">\n                        <tr>\n                        <td style="border-right: none;"></td>\n                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>\n                            <td contenteditable="false" style="font-weight: bold;border-left: none;" colspan="4"> Итого\n                            </td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n                        </tr>\n                        <tr id="stroka">\n                        <td></td>\n                            <td contenteditable="false">1</td>\n                            <td contenteditable="false">\n                                Накладные расходы\n                            </td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n                        </tr>\n\n                        <tr id="stroka">\n                        <td></td>\n                            <td contenteditable="false">2</td>\n                            <td contenteditable="false">\n                                Вспомогательные материалы\n                            </td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n                        </tr>\n\n                        <tr id="stroka">\n                        <td></td>\n                            <td contenteditable="false">3</td>\n                            <td contenteditable="false">\n                                Транспортные расходы\n                            </td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n                        </tr>\n\n                        <tr id="stroka">\n                        <td></td>\n                            <td contenteditable="false">4</td>\n                            <td contenteditable="false" style="font-weight: bold; text-align: right">\n                                ВСЕГО:\n                            </td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n                        </tr>\n                        <tr id="stroka">\n                        <td></td>\n                            <td contenteditable="false">5</td>\n                            <td contenteditable="false" style="font-weight: bold;">\n                                В том числе НДС - 20% за нал от материалов\n                            </td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n                        </tr>\n                    </tbody>\n\n                    <tbody id="result_total">\n                    <tr class="blank_row">\n                        <td colspan="3"></td>\n                    </tr>\n                        <tr>\n                        <td></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="false" style="font-weight: bold; text-align: right">\n                                ВСЕГО:\n                            </td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        </tr>\n                        <tr>\n                        <td></td>\n                            <td contenteditable="false"></td>\n                            <td contenteditable="false" style="font-weight: bold;">\n                                В том числе НДС - 20% за нал от материалов\n                            </td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                            <td contenteditable="true"></td>\n                        </tr>\n                    </tbody>\n                    '#}
function table_roles(role){


    console.warn('!!!!', (role=='Admin'))
if (role == 'ADMIN'){
console.warn('admin!')
    $("td[style*='background']").css("background",'')
    $("input[style*='background']").css("background",'')
    $("input[style*='background']").css("background",'')
    $('.CostMaterial_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.CostMaterial_disabled').css("background","#baffae") // tbody Стоимость материала раздел ПТО
    $('.costWork_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.costWork_disabled').css("background","#baffae")
    $('.Special_disabled').attr( "contenteditable","true" )
    $('.Special_disabled').css("background","#baffae")

    $('.percent').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.percent').css("background","#baffae")
    {#$('.costWork_disabledSpecial_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО#}
    {#$('.costWork_disabledSpecial_disabled').css("background","#baffae")#}

    $('.costWork_role_supplier').attr("contenteditable","true") // блок снабжение
    console.log('!@#!@$!@')
    console.log($('.costWork_role_supplier'))
    $('.costWork_role_supplier').css("background","#baffae")
    {#$('.costWork_role_supplier').attr("style", "display:none") // блок снабжение#}

    $('.costWork_role_boss').attr("contenteditable","true") // блок руководитель в разделе Стоимость работ
    $('.costWork_role_boss').css("background","#baffae")
    //('data-title' , "Введите корректное значение")
    $('.CostMaterial_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.CostMaterial_disabled_input').css("background","#baffae")
    $('.costWork_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.costWork_disabled_input').css("background","#baffae")
    $('.costWork_disabled_textarea').css("background","#baffae")
    $('.Special_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.Special_disabled_input').css("background","#baffae")
{#$('.tehstolbec').attr("style","display: none;")#}
} else if (role == 'SUPPLIER'){
    console.warn('SUPPLIER!')
    $("td[style*='background']").css("background",'')
    $("input[style*='background']").css("background",'')
    $('.CostMaterial_disabled').attr( "contenteditable","false" )
    $('.costWork_disabled').attr( "contenteditable","false" )
    $('.Special_disabled').attr( "contenteditable","false" )
    $('.percent').attr( "contenteditable","false" )
    $('.costWork_role_supplier').attr("contenteditable","true")
    $('.costWork_role_supplier').css("background","#baffae")
    $('.costWork_role_boss').attr("contenteditable","false")
    $('.CostMaterial_disabled_input').attr("readonly","readonly") //$('.CostMaterial_disabled_input').removeAttr("readonly")
    $('.costWork_disabled_input').attr("readonly","readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.Special_disabled_input').attr("readonly","readonly")
    {#$('.tehstolbec').attr("style","display: block;")#}
} else if (role=='ENGINEER'){
    $("td[style*='background']").css("background",'')
    $("input[style*='background']").css("background",'')
    $('.CostMaterial_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.CostMaterial_disabled').css("background","#baffae")
    $('.costWork_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.costWork_disabled').css("background","#baffae")
    $('.Special_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.Special_disabled').css("background","#baffae")
    $('.percent').attr("contenteditable","false") // tbody Стоимость материала раздел ПТО
    $('.costWork_role_supplier').attr("contenteditable","false") // блок снабжение
    $('.costWork_role_boss').attr("contenteditable","false") // блок руководитель в разделе Стоимость работ
    //$('.costWork_role_boss').attr("data-title","неподходящая роль для ввода/изменения данных") // блок руководитель в разделе Стоимость работ
    //('data-title' , "Введите корректное значение")
    $('.CostMaterial_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.CostMaterial_disabled_input').css("background","#baffae")
    $('.costWork_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.costWork_disabled_input').css("background","#baffae")
    $('.Special_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.Special_disabled_input').css("background","#baffae")
} else if (role=='MAIN_ENGINEER'){
    $("td[style*='background']").css("background",'')
    $("input[style*='background']").css("background",'')
    $('.CostMaterial_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.CostMaterial_disabled').css("background","#baffae")
    $('.costWork_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.costWork_disabled').css("background","#baffae")
    $('.Special_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.Special_disabled').css("background","#baffae")
    $('.percent').attr("contenteditable","false") // tbody Стоимость материала раздел ПТО
    $('.costWork_role_supplier').attr("contenteditable","true") // блок снабжение
    $('.costWork_role_supplier').css("background","#baffae")
    $('.costWork_role_boss').attr("contenteditable","false") // блок руководитель в разделе Стоимость работ
    //('data-title' , "Введите корректное значение")
    $('.CostMaterial_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.CostMaterial_disabled_input').css("background","#baffae")
    $('.costWork_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.costWork_disabled_input').css("background","#baffae")
    $('.Special_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.Special_disabled_input').css("background","#baffae")
} else if (role=='BOSS'){
    $("td[style*='background']").css("background",'')
    $("input[style*='background']").css("background",'')
    $('.CostMaterial_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.CostMaterial_disabled').css("background","#baffae")
    $('.costWork_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.costWork_disabled').css("background","#baffae")
    $('.Special_disabled').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.Special_disabled').css("background","#baffae")
    $('.percent').attr("contenteditable","true") // tbody Стоимость материала раздел ПТО
    $('.percent').css("background","#baffae")
    $('.costWork_role_supplier').attr("contenteditable","true") // блок снабжение
    $('.costWork_role_supplier').css("background","#baffae")
    $('.costWork_role_boss').attr("contenteditable","true") // блок руководитель в разделе Стоимость работ
    $('.costWork_role_boss').css("background","#baffae")
    //('data-title' , "Введите корректное значение")
    $('.CostMaterial_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.CostMaterial_disabled_input').css("background","#baffae")
    $('.costWork_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.costWork_disabled_input').css("background","#baffae")
    $('.Special_disabled_input').removeAttr("readonly")//$('.CostMaterial_disabled_input').attr("readonly","readonly")
    $('.Special_disabled_input').css("background","#baffae")
}
}

/**
 * Функция для поиска и возврата наибольшего ID элементов переданных в параметре 'elem' по маске ID переданном в 'id'
 * @seach_ID_table elem, id
 */
function seach_ID_table(elem,id){
    {#let temp = JSON.parse(responseText).value_table;#}
    {#console.log(temp);#}
    let temp = $(`#first_table ${elem}[id^="${id}"]`);
    {#console.log(temp);#}
    let arr_search_id = []
    for (let key in temp) {
    if (temp.hasOwnProperty(key)) {
    {#console.log('key : '+key)#}
        arr_search_id.push(temp[key].id)
        }
    }
    {#console.log(arr_search_id)#}
    //console.log(max_id_tr(arr_search_id))
    return max_id_tr(arr_search_id); // Макимальный ID
{#console.log(Math.max(...arr_search_id))#}
}

function max_id_tr(arr){
    let arr_ID = []
    arr = arr.slice(0, -4)
    {#console.log('arr:' + arr);#}

    arr.forEach(e => {
        {#console.log('e.slice(e.indexOf():' + e.slice(e.lastIndexOf('_')+1));#}
        if(e.indexOf('_')!=-1) arr_ID.push(e.slice(e.lastIndexOf('_')+1))
    })
    return Math.max(...arr_ID)
}

function for_event_tr(elem,id,id_count){
    let temp = $(`#first_table ${elem}[id^="${id}"]`);
    let arr_search_id = [];
    for (let key in temp) {
    if (temp.hasOwnProperty(key)) {
        arr_search_id.push(temp[key])
        }
    }
    arr_search_id = arr_search_id.slice(0, -4)
    arr_search_id.forEach(e =>event_tr(e))
{#    console.log('!!!');
    console.log(arr_search_id[0]);#}
}

function for_total_table(){
    let temp = $(`#first_table tbody[id^='earthWorks_costWork_']`);
    for (let key in temp) {
        if (temp.hasOwnProperty(key)) {
            if (["length", "prevObject", "context", "selector"].indexOf(key) == -1) {
                {#console.log('for (let key in temp) key: ', temp[key].id.slice(temp[key].id.lastIndexOf('_')+1))#}
                table_earthWorks_Total(temp[key].id.slice(temp[key].id.lastIndexOf('_')+1))
                console.warn(temp)
            }
        }
    }
    //table_earthWorks_Total(coll_table);
}


function up_obj_global_sum(){
    let temp = $(`#first_table tbody`);
    {#console.log('temp !!! ' + temp)#}
    let temp_arr = Object.keys(temp).slice(0, -4);
    {#temp = temp.slice(1, temp.length-2)#}
    {#console.log(temp)#}
    {#console.log(temp_arr)#}
    for (let key in temp) {
    if (temp.hasOwnProperty(key)) {
    if (["length","prevObject","context","selector"].indexOf(key)== -1){

        if (temp[key].childNodes[1].childNodes.length > 7){

            if (temp[key].childNodes[1].childNodes[7].innerHTML != '' || temp[key].id.indexOf('earthWorks_Total_') == 0){
                console.warn(temp[key])
                console.warn(temp[key].childNodes[1].childNodes[7])
                console.warn('temp[key]')
                 obj_global_sum[temp[key].id] = temp[key].childNodes[1].childNodes[7].innerHTML;

                 if (temp[key].id.indexOf('earthWorks_Total_') == 0){
                    if (temp[key].childNodes[3].childNodes[9].innerText!= ''){
                        obj_global_sum['Накладные_расходы_' + temp[key].id.slice(temp[key].id.lastIndexOf('_')+1)] = temp[key].childNodes[3].childNodes[9].innerText.replace(',','.').replace('%','')
                    }
                    if (temp[key].childNodes[5].childNodes[9].innerText!= ''){
                        obj_global_sum['Вспомогательные_материалы_' + temp[key].id.slice(temp[key].id.lastIndexOf('_')+1)] = temp[key].childNodes[5].childNodes[9].innerText.replace(',','.').replace('%','')
                    }
                    if (temp[key].childNodes[7].childNodes[9].innerText!= ''){
                        obj_global_sum['Транспортные_расходы_' + temp[key].id.slice(temp[key].id.lastIndexOf('_')+1)] = temp[key].childNodes[7].childNodes[9].innerText.replace(',','.').replace('%','')
                    }
                    if (temp[key].childNodes[9].childNodes[13].innerText!= ''){
                        obj_global_sum['ВСЕГО_' + temp[key].id.slice(temp[key].id.lastIndexOf('_')+1)] = temp[key].childNodes[9].childNodes[13].innerText.replace(',','.').replace('%','')

                    }
                    if (temp[key].childNodes[11].childNodes[13].innerText!= ''){
                        obj_global_sum['ВСЕГО_НДС_' + temp[key].id.slice(temp[key].id.lastIndexOf('_')+1)] = temp[key].childNodes[11].childNodes[13].innerText
                    }

                 }
                }
                  else {
                      obj_global_sum[temp[key].id] = ''
                }
            }
        }
    }

    }

}






save_table_function=document.getElementById('saveTable').onclick =async function (poin,description="Без описания") {
    console.log("description",description)
    event.preventDefault();
    let response = await fetch('/techTask/formPtoCreateUpdate', {
  method: 'POST',
  headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
        "Authorization": getCookieValue("Authorization")
  },
  body: JSON.stringify({"NameTechTask_key": {{getTechTaskName.NameTechTask|tojson|safe}},"description":
  document.getElementById("saveTable_description").getAttribute("value")?document.getElementById("saveTable_description").getAttribute("value"):description, "value_table": document.getElementById("first_table").innerHTML})

});
        let responseText = await response.text();
     document.getElementById('saveTable_description').value = ''
     //document.getElementById('saveTable_description').setAttribute("value","")

 if (response.status==200){
            etalon_table = true;
            upTableTime(0,false);
            etalon_html_table = document.getElementById("first_table").innerHTML
            table_roles(JSON.parse({{roles_user|tojson|safe}} )[0])
            state_table=JSON.parse(await status_table(state=false,check=false))
            etalon_ID=state_table.id_actual_table
            //document.getElementById("first_table").innerHTML.replaceAll('display:none','').replaceAll('readonly="readonly"','').replaceAll('true','').replaceAll('false','').replaceAll('display:table-cell','')
            Test();
            showToast('Данные успешно сохранены' , 'info' , 5000)
 }else{

            showToast('Ошибка сохранения' , 'warning' , 5000)

 }

console.log("responseText",responseText)

  };

let obj_global_sum = {};
obj_global_sum['result_total'] = "";

const table = document.getElementById('first_table');

            let coll_table = 1;
            let arr_coll_table = [1];
            let id_count = 1;
            let arr_id_count = [1];


/** Функция возвращает html добавялемой строки в зависимоти от раздела
* @objLine
*/
    function objLine(id_count, forTable) {
        if (coll_table<=seach_ID_table('tbody','earthWorks_')) {coll_table = seach_ID_table('tbody','earthWorks_')+1;}

        let addLineObj = new Object();
        addLineObj = {
            'earthWorks_costWork': `<tr id = "stroka_${id_count}">
<td contenteditable="false"  class="tehstolbec" style="white-space: nowrap;"><button type = "button" aria-hidden="true" class="delbtn fa fa-plus-square-o" id="addbtn${id_count}" style="margin-right: 5px;" onclick="addBetweenLine(event.target.id)"><button type = "button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_${id_count}"></button></td>


                            <td contenteditable="false">

                            </td>
                            <td contenteditable="false" class="costWork_disabled_input" style="padding: 0; height: 1px; height: -moz-available;">

                            <div id="div_costWork_${id_count}" style = "border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">
                            <textarea id = 'textarea_costWork_${id_count}' name="textAreaComment" class="costWork_disabled_input" style=" border:  0;  resize: none; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2); height: 100%; vertical-align: top;"></textarea>

                            <input id = 'input_costWork_${id_count}' name="textInputComment" type="text"  class="costWork_disabled_input"  list="datalist_costWork_${id_count}"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2); display: none;" autocomplete="off">
                            <datalist id="datalist_costWork_${id_count}">
                            </datalist>
                            </div></td>
                            <td contenteditable="false" style="padding: 0; height: 1px; height: -moz-available;">
                            <div id="div_costWorkEdIzm_${id_count}" style = "border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">
                            <input id = 'input_costWorkEdIzm_${id_count}' class="costWork_disabled_input" type="text"   list="datalist_costWorkEdIzm_${id_count}"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">
                            <datalist id="datalist_costWorkEdIzm_${id_count}">
                            </datalist>
                            </div>
                            </td>


                            <td contenteditable="true" class="costWork_disabled"></td>
                            <td contenteditable="true" class="costWork_disabled"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="true" class="costWork_disabled"></td>
                            <td contenteditable="false" ></td>
                            <td contenteditable="true" class="costWork_disabled"></td>
                            <td contenteditable="true" class="costWork_disabled note"></td>
                        <td contenteditable="true" class="costWork_role_boss pto" style="display:none"></td>
                        <td contenteditable="true" class="costWork_role_boss pto" style="display:none"></td>
                        <td contenteditable="false" class="costWork_role_boss pto" style="display:none"></td>
                        <td contenteditable="true" class="costWork_role_boss pto" style="display:none"></td>
                        <td contenteditable="false" class="costWork_role_boss pto" style="display:none"></td>
                        </tr>`,
            'earthWorks_costMaterial': `<tr id = "stroka_${id_count}">
<td contenteditable="false"  class="tehstolbec" style="white-space: nowrap;"><button type = "button" aria-hidden="true" class="delbtn fa fa-plus-square-o" id="addbtn${id_count}" style="margin-right: 5px;" onclick="addBetweenLine(event.target.id)"><button type = "button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_${id_count}"></button></td>
<td contenteditable="false"></td>

                            <td contenteditable="false" class="CostMaterial_disabled_input" style="padding: 0; height: 1px; height: -moz-available;">
                            <div id="div_costMaterial_${id_count}" style = "border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">
                            <textarea id = 'textarea_costMaterial_${id_count}' name="textAreaComment" class="CostMaterial_disabled_input" style=" border:  0;  resize: none; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2); height: 100%; vertical-align: top;"></textarea>

                            <input id = 'input_costMaterial_${id_count}' name="textInputComment" class="CostMaterial_disabled_input" type="text"   list="datalist_costMaterial_${id_count}"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2); display: none;" autocomplete="off">
                            <datalist id="datalist_costMaterial_${id_count}">
                            </datalist>
                            </div>
                            </td>

                            <td contenteditable="false" style="padding: 0; height: 1px; height: -moz-available;">
                            <div id="div_costMaterialEdIzm_${id_count}" style = "border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">
                            <input id = 'input_costMaterialEdIzm_${id_count}' class="CostMaterial_disabled_input" type="text"   list="datalist_costMaterialEdIzm_${id_count}"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">
                            <datalist id="datalist_costMaterialEdIzm_${id_count}">
                            </datalist>
                            </div>
                            </td>

                            <td contenteditable="true" class="CostMaterial_disabled"></td>
                            <td contenteditable="true" class="CostMaterial_disabled"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="true" class="CostMaterial_disabled"></td>
                            <td contenteditable="true" class="CostMaterial_disabled"></td>
                            <td contenteditable="true" class="CostMaterial_disabled"></td>
                            <td contenteditable="true" class="CostMaterial_disabled note"></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none"> <input id="costWork_file_${id_count}" type="file"></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto note" style="display:none"></td>
                        </tr>`,
            'earthWorks_Special': `<tr id = "stroka_${id_count}">
<td contenteditable="false"  class="tehstolbec" style="white-space: nowrap;"><button type = "button" aria-hidden="true" class="delbtn fa fa-plus-square-o" id="addbtn${id_count}" style="margin-right: 5px;" onclick="addBetweenLine(event.target.id)"><button type = "button" aria-hidden="true" class="delbtn fa fa-trash-o" id="delbtn_${id_count}"></button></td>
<td contenteditable="false"></td>
                            <td contenteditable="false" style="padding: 0; height: 1px; height: -moz-available;">
                            <div id="div_Special_${id_count}" style = "border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">
                            <input id = 'input_Special_${id_count}' type="text"  class="Special_disabled_input" list="datalist_Special_${id_count}"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">
                            <datalist id="datalist_Special_${id_count}">
                            </datalist>
                            </div>
                            </td>


                            <td contenteditable="false" style="padding: 0; height: 1px; height: -moz-available;">
                            <div id="div_SpecialEdIzm_${id_count}" style = "border: 0; padding: 0; margin: 0; width: 100%; height: 100%;">
                            <input id = 'input_SpecialEdIzm_${id_count}' type="text" class="Special_disabled_input"  list="datalist_SpecialEdIzm_${id_count}"  value= ''   style = "width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">
                            <datalist id="datalist_SpecialEdIzm_${id_count}">
                            </datalist>
                            </div>
                            </td>


                            <td contenteditable="true" class="Special_disabled"></td>
                            <td contenteditable="true" class="Special_disabled"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="true" class="Special_disabled"></td>
                            <td contenteditable="true" class="Special_disabled"></td>
                            <td contenteditable="true" class="Special_disabled"></td>
                            <td contenteditable="true" class="Special_disabled note"></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""></td>
                        <td contenteditable="true" class="costWork_role_supplier pto" style="display:none""><input id="Special_file_${id_count}" type="file"></td>
                        <td contenteditable="true" class="costWork_role_supplier pto " style="display:none""></td>
                        </tr>`,
        };

        return addLineObj[forTable];
    }


let time
function showButton (event, elem){
elem = elem.id;
if (JSON.parse({{roles_user|tojson|safe}} )[0]!= 'SUPPLIER'){
    document.getElementById(elem).childNodes[1].style.display = "block";
}

}
function closeButton (event,elem){

    elem = elem.id;
    document.getElementById(elem).childNodes[1].style.display = "none";
}
// sum от объекта
/** Функция возвращает сумму значений объекта по разделам в одной таблице, ID которой передается в параметре.
*
*/
function func_sum_total(id){
let sum = 0;
console.log('ID !!! ', id, 'obj_global_sum: ');

let coll_table = id.slice(id.lastIndexOf('_')+1)
console.log(obj_global_sum['earthWorks_costWork_'+ coll_table]);
console.log(obj_global_sum['earthWorks_costMaterial_'+ coll_table]);
console.log(obj_global_sum['earthWorks_Special_'+ coll_table]);

sum = Number(obj_global_sum['earthWorks_costWork_'+ coll_table]) +
        Number(obj_global_sum['earthWorks_costMaterial_'+ coll_table]) +
        Number(obj_global_sum['earthWorks_Special_'+ coll_table]);

return sum;
}

function PTO_td_sum(elem_stroka){
{#console.warn('!!! elem_stroka', elem_stroka)#}
console.log('ПТО СУММ')
    let sum_total = 0;
    let sum_analysis = 0;
    let dir_sum_total=0;
    let dir_sum_analysis = 0;
    $(`#${elem_stroka.parentElement.id} tr`).each(function () {
        {#console.log('v if zahel this =  ' + this.id + '   ' + this.id.indexOf('stroka') + '  this.childNodes[13].innerText ' + this.childNodes[13].innerText)#}
        if (this.id.indexOf('stroka')!=-1 ) {
            sum_total += Number(this.childNodes[13].innerText.replace(',','.'))
            dir_sum_total += Number(this.childNodes[27].innerText.replace(',','.'))
            sum_analysis += Number(this.childNodes[15].innerText.replace(',','.'))
            dir_sum_analysis += Number(this.childNodes[29].innerText.replace(',','.'))
        }
    });
    // пересчет Столбец для анализа из переданной строчки
    console.log('elem_stroka.childNodes[15]')
    console.log(elem_stroka.childNodes[15])
    if (elem_stroka.parentElement.id.indexOf('earthWorks_costWork')!=-1 && elem_stroka.childNodes[15].innerText!= '' && !isNaN(elem_stroka.childNodes[15].innerText.replace(',','.'))){
        elem_stroka.childNodes[17].innerText = (Number(elem_stroka.childNodes[13].innerText.replace(',','.')).toFixed(2)/Number(elem_stroka.childNodes[15].innerText.replace(',','.')).toFixed(2)).toFixed(2)
        elem_stroka.childNodes[31].innerText = (Number(elem_stroka.childNodes[27].innerText.replace(',','.')).toFixed(2)/Number(elem_stroka.childNodes[29].innerText.replace(',','.')).toFixed(2)).toFixed(2)
        }

    {#console.log('присваиваю суммы: ' + sum_total.toFixed(2) + ' and ' + sum_analysis.toFixed(2))#}
    elem_stroka.parentElement.childNodes[1].childNodes[7].innerText = sum_total.toFixed(2);


    obj_global_sum[elem_stroka.parentElement.id] = Number(sum_total);

    // присвоение суммы в строчку ИТОГО
    obj_global_sum['earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)] = func_sum_total('earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1) );


    // подсчет ВСЕГО в одной таблице с вызовом из ячеек td
    let summa_v_itogo = 0;
    let id_for_itogo = elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)

    console.warn('!!!', elem_stroka)
    if (Object.keys(obj_global_sum).indexOf('Накладные_расходы_'+ id_for_itogo)!=-1 && obj_global_sum['Накладные_расходы_'+ id_for_itogo]!= '' && obj_global_sum['earthWorks_costWork_'+ id_for_itogo]!= ''){

        summa_v_itogo += Number(obj_global_sum['Накладные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costWork_'+ id_for_itogo]
        if (document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[3].childNodes[13].innerText != Number(obj_global_sum['Накладные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costWork_'+ id_for_itogo]){
            document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[3].childNodes[13].innerText = (Number(obj_global_sum['Накладные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costWork_'+ id_for_itogo]).toFixed(2)
        }
    }
    if (Object.keys(obj_global_sum).indexOf('Вспомогательные_материалы_'+ id_for_itogo)!=-1 && obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo]!= '' && obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]!= '') {
        summa_v_itogo += Number(obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]
        if (document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[5].childNodes[13].innerText != Number(obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]){
            document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[5].childNodes[13].innerText = (Number(obj_global_sum['Вспомогательные_материалы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]).toFixed(2)
        }
    }

    // fix формула рассчета Транспортные_расходы от стоимости материалов вместо Стоимость спецтехники
    if (Object.keys(obj_global_sum).indexOf('Транспортные_расходы_'+ id_for_itogo)!=-1 && obj_global_sum['Транспортные_расходы_'+ id_for_itogo]!= '' && obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]!= '') {
        summa_v_itogo += Number(obj_global_sum['Транспортные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]
        if (document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[7].childNodes[13].innerText != Number(obj_global_sum['Транспортные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]){
            document.getElementById('earthWorks_Total_'+id_for_itogo).childNodes[7].childNodes[13].innerText = (Number(obj_global_sum['Транспортные_расходы_'+ id_for_itogo])/100 * obj_global_sum['earthWorks_costMaterial_'+ id_for_itogo]).toFixed(2)
        }
    }
    console.log('summa_v_itogo ', summa_v_itogo.toFixed(2))
    if (summa_v_itogo>0 && obj_global_sum['earthWorks_Total_'+id_for_itogo]!= ''){
        obj_global_sum['ВСЕГО_'+elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)] = (obj_global_sum['earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)] + Number(summa_v_itogo.toFixed(2))).toFixed(2);
        console.log("присвоение ", obj_global_sum['earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)],' + ',  Number(summa_v_itogo.toFixed(2)) )
        pereschetTotalSum();
    }
    if (obj_global_sum['ВСЕГО_'+id_for_itogo] != '' && !isNaN(obj_global_sum['ВСЕГО_'+id_for_itogo])) {
        document.getElementById('earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)).childNodes[9].childNodes[13].innerText = obj_global_sum['ВСЕГО_'+elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)];
    }

    console.log('!!!!', obj_global_sum['earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)])
    document.getElementById('earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)).childNodes[1].childNodes[7].innerText = obj_global_sum['earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)].toFixed(2);
    if (elem_stroka.parentElement.id.indexOf('earthWorks_costWork')!=-1) {
        elem_stroka.parentElement.childNodes[1].childNodes[21].innerText = dir_sum_total.toFixed(2);
        elem_stroka.parentElement.childNodes[1].childNodes[9].innerText = sum_analysis.toFixed(2);
        elem_stroka.parentElement.childNodes[1].childNodes[23].innerText = dir_sum_analysis.toFixed(2);

    }
    if (sum_analysis != 0 && elem_stroka.parentElement.id.indexOf('earthWorks_costWork')!=-1){
    elem_stroka.parentElement.childNodes[1].childNodes[11].innerText = (sum_total.toFixed(2)/sum_analysis.toFixed(2)).toFixed(2);
    elem_stroka.parentElement.childNodes[1].childNodes[25].innerText = (dir_sum_total.toFixed(2)/dir_sum_analysis.toFixed(2)).toFixed(2);

    }

         // подсчет ВСЕГО_НДС
    {#if (elem_stroka.parentElement.id.indexOf('earthWorks_costMaterial_')!=-1){#}
    //}
        if (Object.keys(obj_global_sum).indexOf('ВСЕГО_' + elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1))!=-1 && obj_global_sum['ВСЕГО_' + elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)]!=''){
        console.log('EEE'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1))
        console.log(sum_total)
        console.log(Object.keys(obj_global_sum))
        console.log(sum_total)
        //   *20/120   * на % и / на 120
        if ($('#earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1))[0].childNodes[11].childNodes[9].innerText != '' && !isNaN($('#earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1))[0].childNodes[11].childNodes[9].innerText.replace(',','.').replace('%',''))){
        let proc = $('#earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1))[0].childNodes[11].childNodes[9].innerText.replace(',','.').replace('%','');
        {#alert(proc)#}
        obj_global_sum['ВСЕГО_НДС_' + elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)] = ((obj_global_sum['ВСЕГО_' + elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)] * Number(proc)) / (100+Number(proc))).toFixed(2)
        $('#earthWorks_Total_'+ elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1))[0].childNodes[11].childNodes[13].innerText = obj_global_sum['ВСЕГО_НДС_' + elem_stroka.parentElement.id.slice(elem_stroka.parentElement.id.lastIndexOf('_')+1)]
        {#alert('tyt')#}
        pereschetTotalNDS();
        }

        }

}

/**
 * Функция считает суммы строк и общие суммы в "Стоимость работ" для столбцов "Корректируется Руководителем работ"
 * @param elem_stroka
 * @constructor
 * elem_stroka - getElementById строки таблицы по которой берется .parentElement 'tbody'
 */

function Director_td_sum(elem_stroka){
    let sum_total = 0;
    let sum_analysis = 0;
    $(`#${elem_stroka.parentElement.id} tr`).each(function () {
        if (this.id.indexOf('stroka')!=-1 ) {
            sum_total += Number(this.childNodes[27].innerText.replace(',','.'))
            sum_analysis += Number(this.childNodes[29].innerText.replace(',','.'))
        }
    });
    // пересчет Столбец для анализа из переданной строчки
{# 25-11;  27-13;  23-9;  29-15;  31-17#}
    if (elem_stroka.parentElement.id.indexOf('earthWorks_costWork')!=-1 && elem_stroka.childNodes[29].innerText!= '' && !isNaN(elem_stroka.childNodes[29].innerText.replace(',','.'))){
        elem_stroka.childNodes[31].innerText = (Number(elem_stroka.childNodes[27].innerText.replace(',','.')).toFixed(2)/Number(elem_stroka.childNodes[29].innerText.replace(',','.')).toFixed(2)).toFixed(2)
        }
    elem_stroka.parentElement.childNodes[1].childNodes[21].innerText = sum_total.toFixed(2);

    if (elem_stroka.parentElement.id.indexOf('earthWorks_costWork')!=-1) {
        elem_stroka.parentElement.childNodes[1].childNodes[23].innerText = sum_analysis.toFixed(2);
    }
    if (sum_analysis != 0 && elem_stroka.parentElement.id.indexOf('earthWorks_costWork')!=-1){
    elem_stroka.parentElement.childNodes[1].childNodes[25].innerText = (sum_total.toFixed(2)/sum_analysis.toFixed(2)).toFixed(2);
    }
};

function Provision_td_sum(elem_stroka){
    let sum_total = 0;
    $(`#${elem_stroka.parentElement.id} tr`).each(function () {
        if (this.id.indexOf('stroka')!=-1 ) {
            sum_total += Number(this.childNodes[31].innerText.replace(',','.'))
        }
    });
    elem_stroka.parentElement.childNodes[1].childNodes[23].innerText = sum_total.toFixed(2);
};
let obj_table_values = {};
obj_table_values['earthWorks_costWork'] = {};



function collaps_tbody(tbody, id, but){

    console.log(but.innerText)
    console.log(but)
    let temp = $(`#earthWorks_${tbody}_addLine_${id}`)[0].parentElement.parentElement.childNodes
    for (i = 3; i<temp.length; i++){
           if(but.innerText == 'Свернуть'){
           temp[i].setAttribute("style", "display:none")

           } else {
           temp[i].setAttribute("style", "display:table-cells")

           }

    }
    but.innerText == 'Свернуть'? but.innerText = 'Развернуть' : but.innerText = 'Свернуть';

    resize_div_for_table();

}

function addBetweenLine(id){
    console.log("id")
    console.log(id)
    upTableTime();
    if (id_count<=seach_ID_table('tr','stroka_')) {
            {#for_event_tr('tr','stroka_', id_count);#}
            id_count = seach_ID_table('tr','stroka_')+1;
        }
    let element = $(`#${id}`).closest('td')

    let element_id = element.parent().parent()[0].id
    let forObj = element_id.slice(0, element_id.lastIndexOf('_'))
    console.log(forObj)
    let table_values_roles = `` + objLine(id_count, forObj)
    let roles_user = JSON.parse({{roles_user|tojson|safe}} )[0]

    if (roles_user != 'ENGINEER'){
    //&& head.querySelector('.tabsCalcylator__caption_active').dataset.tab != 'enginer_pto'

        table_values_roles = table_values_roles.replaceAll('display:none','display:table-cell')
    }

    {#$(element).append(table_values_roles)#}
    $(`#${id}`).closest('td').parent('tr').after(table_values_roles);
    {#console.warn('id_count = ' + id_count)#}
    let tr_math = document.getElementById('stroka_'+id_count)
    console.log('tr_math -==-')
    console.log(tr_math)

    {# Объект для хранения предыдущих значений таблицы, хранятся данные введеные в ПТО разделе.
    При изменении данных в разделе Руководителя работ,
     #}

    {#console.log(tr_math.childNodes)#}

    event_tr(tr_math);

    {#console.log(tr_math)#}
    //  в td написать вызов функции onkeyup="javascript:dotest(this,event);"

    //let tr_math = document.getElementById('earthWorks_costWork_1')
    //tr_math.childNodes[1].childNodes[7]

    forObj = forObj.slice(forObj.indexOf('_')+1)

    let forEdIzm = tr_math.childNodes[7].childNodes[1].id;
    forEdIzm = forEdIzm.slice(forEdIzm.indexOf('_')+1,forEdIzm.lastIndexOf('_'))
    console.log('forEdIzm === ', forEdIzm)

    // события на вложения
    {#document.getElementById('costWork_file_' + id_count).onchange = uploadfile_func_table(id_count);#}
    {#document.getElementById('Special_file_' + id_count).onchange = uploadfile_func_table(id_count);#}



    input_event_addLine(forEdIzm,id_count);
    input_event_addLine(forObj,id_count);

    function input_event_addLine(forObj, id_count){
        $(`#div_${forObj}_${id_count}`).delegate(":input", "input", function (e) {
    let type = forObj;
    console.warn('!@#this div_ : ', this)
    let id_count=e.target.id.slice(e.target.id.lastIndexOf('_')+1)
    {#console.log("stroka = " + " #datalist_" + forObj + "_"+id_count)#}
        var options = $("#datalist_" + forObj + "_"+id_count)[0].options;
        {#console.log("options = " + options)#}
        if (options.length != 0 && options[options.length - 1].value == $(this).val()) {
            {# Определить type по target.id#}

            if ($(this).val().indexOf("Добавить в список \"") != -1) {
                set_setSuggest(type, $(this).val().replace("Добавить в список \"", "").slice(0, -1),`datalist_${forObj}_${id_count}`)
                $(`#input_${forObj}_${id_count}`).val($(this).val().replace("Добавить в список \"", "").slice(0, -1));
            }
            return
        }
        set_options_datalist(type, e.target.value,"datalist_" + forObj +"_"+id_count, 30)

    });
    }

    counterTr();
                id_count++;
                arr_id_count.push(id_count);

    table_roles(JSON.parse({{roles_user|tojson|safe}} )[0])
    resize_div_for_table()
    {#$(`#${id}`).closest('td').parent('tr').after("<tr id = 'third'><td>5</td><td>6</td></tr>");#}

}

function resize_div_for_table(){
            let vblsota=window.innerHeight-100
            let vv=first_table.offsetHeight
            if (vv>vblsota){
                $(".table-responsive-pto").css("height",`${vblsota}`)
            } else {
                $(".table-responsive-pto").css("height",`${vv}`)
            }
}

/**
 * Функция добавляет строку, события строки и присваевает ID элементам новой строки. Вызывается по нажатию кнопок AddLine в разделах таблицы
 * @addLine event, element
 */
function addLine(event, element){
    //  добавление к строке $('#delbtn_1').closest('td').parent('tr').after("<tr id = 'third'><td>5</td><td>6</td></tr>");
    console.log('tyt')
    console.log(event)
    console.log(element)
    event.preventDefault();
    etalon_table = false;
    upTableTime();
    if (id_count<=seach_ID_table('tr','stroka_')) {
            {#for_event_tr('tr','stroka_', id_count);#}
            id_count = seach_ID_table('tr','stroka_')+1;
        }

    element = element.parentElement.parentElement.parentElement.parentElement;
    console.log("element")
    console.log(element)
    let element_id = element.id;
    let forObj = element_id.slice(0, element_id.lastIndexOf('_'))

    //const head = document.querySelector('.tabsCalcylator__head') // ищем элемент с кнопками и записываем в константу

    let table_values_roles = `` + objLine(id_count, forObj)
    let roles_user = JSON.parse({{roles_user|tojson|safe}} )[0]

    if (roles_user != 'ENGINEER'){
    //&& head.querySelector('.tabsCalcylator__caption_active').dataset.tab != 'enginer_pto'

        table_values_roles = table_values_roles.replaceAll('display:none','display:table-cell')
    }

    $(element).append(table_values_roles)
    {#console.warn('id_count = ' + id_count)#}
    let tr_math = document.getElementById('stroka_'+id_count)
    console.log('tr_math -==-')
    console.log(tr_math)

    {# Объект для хранения предыдущих значений таблицы, хранятся данные введеные в ПТО разделе.
    При изменении данных в разделе Руководителя работ,
     #}

    {#console.log(tr_math.childNodes)#}

    event_tr(tr_math);

    {#console.log(tr_math)#}
    //  в td написать вызов функции onkeyup="javascript:dotest(this,event);"

    //let tr_math = document.getElementById('earthWorks_costWork_1')
    //tr_math.childNodes[1].childNodes[7]

    forObj = forObj.slice(forObj.indexOf('_')+1)

    let forEdIzm = tr_math.childNodes[7].childNodes[1].id;
    forEdIzm = forEdIzm.slice(forEdIzm.indexOf('_')+1,forEdIzm.lastIndexOf('_'))
    console.log('forEdIzm === ', forEdIzm)

    // события на вложения
    {#document.getElementById('costWork_file_' + id_count).onchange = uploadfile_func_table(id_count);#}
    {#document.getElementById('Special_file_' + id_count).onchange = uploadfile_func_table(id_count);#}



    input_event_addLine(forEdIzm,id_count);
    input_event_addLine(forObj,id_count);

    function input_event_addLine(forObj, id_count){
        $(`#div_${forObj}_${id_count}`).delegate(":input", "input", function (e) {
    let type = forObj;
    console.warn('!@#this div_ : ', this)
    let id_count=e.target.id.slice(e.target.id.lastIndexOf('_')+1)
    {#console.log("stroka = " + " #datalist_" + forObj + "_"+id_count)#}
        var options = $("#datalist_" + forObj + "_"+id_count)[0].options;
        {#console.log("options = " + options)#}
        if (options.length != 0 && options[options.length - 1].value == $(this).val()) {
            {# Определить type по target.id#}

            if ($(this).val().indexOf("Добавить в список \"") != -1) {
                set_setSuggest(type, $(this).val().replace("Добавить в список \"", "").slice(0, -1),`datalist_${forObj}_${id_count}`)
                $(`#input_${forObj}_${id_count}`).val($(this).val().replace("Добавить в список \"", "").slice(0, -1));
            }
            return
        }
        set_options_datalist(type, e.target.value,"datalist_" + forObj +"_"+id_count, 30)

    });
    }

    counterTr();
                id_count++;
                arr_id_count.push(id_count);

    table_roles(JSON.parse({{roles_user|tojson|safe}} )[0])
    resize_div_for_table()
    //event_all_td()
}

{#function event_all_td(){#}
{#//alert('tyt')#}
{#let all_td = $('#first_table td')#}
{##}
{#for (let cell_td in all_td){#}
{#    if (!isNaN(cell_td)){#}
{#        $('#first_table td')[cell_td].addEventListener('keyup', function(event) {#}
{#        if ($('#first_table td')[cell_td].classList.length>0){#}
{#            for (let i=0; i<$('#first_table td')[cell_td].classList.length; i++){#}
{#                if ($('#first_table td')[cell_td].classList[i].indexOf('editor')!=-1){#}
{#                    $('#first_table td')[cell_td].classList.remove($('#first_table td')[cell_td].classList[i])#}
{#                }#}
{#            }#}
{#        }#}
{#        $('#first_table td')[cell_td].classList.add(`editor_${(JSON.parse({{roles_user|tojson|safe}} )[0])}`);#}
{#        //editor_ADMIN  editor_ENGINEER  editor_MAIN_ENGINEER   editor_BOSS   editor_SUPPLIER#}
{#        console.warn($('#first_table td')[cell_td])#}
{#        console.warn('alert')#}
{#        console.warn('roles = ', (JSON.parse({{roles_user|tojson|safe}} )[0]))#}
{#        })#}
{#    }#}
{##}
//}
//}
{##}

function event_tr (tr_math){

{#console.warn('tr_math: ' + tr_math.innerHTML)#}

obj_table_values['earthWorks_costWork'][tr_math.id] = {}
if (tr_math.childNodes[9].innerText != '') {
    obj_table_values['earthWorks_costWork'][tr_math.id]['9'] = Number(tr_math.childNodes[9].innerText.replace(',','.')).toFixed(2)
} else obj_table_values['earthWorks_costWork'][tr_math.id]['9'] = "";

if (tr_math.childNodes[11].innerText != '') {
    obj_table_values['earthWorks_costWork'][tr_math.id]['11'] = Number(tr_math.childNodes[11].innerText.replace(',','.')).toFixed(2)
} else obj_table_values['earthWorks_costWork'][tr_math.id]['11'] = "";

if (tr_math.childNodes[15].innerText != '') {
    obj_table_values['earthWorks_costWork'][tr_math.id]['15'] = Number(tr_math.childNodes[15].innerText.replace(',','.')).toFixed(2)
} else obj_table_values['earthWorks_costWork'][tr_math.id]['15'] = "";

// события обработки ячеек таблицы
console.log('передал 9')
formulaTable(tr_math.childNodes[9])
console.log('вернулся 9')
tr_math.childNodes[9].addEventListener('focusout', function(event) {
tr_math.childNodes[9].removeAttribute('data-title')
{#console.log(obj_table_values['earthWorks_costWork'][tr_math][9] == '')#}
{#console.log(obj_table_values['earthWorks_costWork'][tr_math.id]['9'])#}
        //if (!isNaN(tr_math.childNodes[9].innerText.replace(',','.')) && tr_math.childNodes[9].innerText != ''){
        if (tr_math.childNodes[9].innerText != ''){

        if (obj_table_values['earthWorks_costWork'][tr_math.id]['9'] == "" || Number(obj_table_values['earthWorks_costWork'][tr_math.id]['9']).toFixed(2) == Number(tr_math.childNodes[23].innerText.replace(',','.')).toFixed(2))
            {obj_table_values['earthWorks_costWork'][tr_math.id]['9'] = Number(tr_math.childNodes[9].innerText.replace(',','.')).toFixed(2)
            if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1) {
                tr_math.childNodes[23].innerText = Number(tr_math.childNodes[9].innerText.replace(',','.')).toFixed(2);
            }
            }
            if(tr_math.parentElement.id.indexOf('earthWorks_costMaterial_')!=-1){

                if (!isNaN(tr_math.childNodes[15].innerText.replace(',','.')) && tr_math.childNodes[15].innerText!=''){
                tr_math.childNodes[9].innerText = Number(eval((tr_math.childNodes[9]).abbr.replaceAll(',','.')) * Number(eval(tr_math.childNodes[15].abbr.replaceAll(',','.')))).toFixed(2);
                } else {
                    tr_math.childNodes[9].innerText = (Number(eval(tr_math.childNodes[9].innerText.replaceAll(',','.')))*1).toFixed(2)
                }
                if (!isNaN(tr_math.childNodes[11].innerText.replace(',','.')) && tr_math.childNodes[11].innerText!=''){
                    tr_math.childNodes[13].innerText = ((Number(tr_math.childNodes[9].innerText.replace(',','.')) * Number(tr_math.childNodes[11].innerText.replace(',','.')))).toFixed(2)

                }
            }
        if (!isNaN(tr_math.childNodes[11].innerText.replace(',','.')) && tr_math.childNodes[11].innerText != ''){

        tr_math.childNodes[13].innerText = ((Number(tr_math.childNodes[9].innerText.replace(',','.')) * Number(tr_math.childNodes[11].innerText.replace(',','.')))).toFixed(2)
        if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1) {
            tr_math.childNodes[27].innerText = ((Number(tr_math.childNodes[23].innerText.replace(',','.')) * Number(tr_math.childNodes[25].innerText.replace(',','.')))).toFixed(2);
        }
        }
} else {tr_math.childNodes[13].innerText = '';
        tr_math.childNodes[9].setAttribute('data-title' , "Введите корректное значение");
        PTO_td_sum(tr_math);}
if(tr_math.childNodes[13].innerText != ''){

    PTO_td_sum(tr_math);
}
});
console.log('передал 11 ')
formulaTable(tr_math.childNodes[11])
console.log('вернулся 11 ')
tr_math.childNodes[11].addEventListener('focusout', function(event) {
tr_math.childNodes[11].removeAttribute('data-title')

console.log('innerText')
console.log(tr_math.childNodes[11].innerText)

    if (tr_math.childNodes[11].innerText != '' ){

console.log('222innerText')
console.log(Number(tr_math.childNodes[25].innerText))
console.log('tr_math.childNodes[11].innerText')
console.log(eval(tr_math.childNodes[11].innerText.replace(',','.')))


        if (obj_table_values['earthWorks_costWork'][tr_math.id]['11'] == "" || Number(obj_table_values['earthWorks_costWork'][tr_math.id]['11']).toFixed(2) == Number(tr_math.childNodes[25].innerText.replace(',','.')).toFixed(2))
            {
        console.log('111innerText')

            obj_table_values['earthWorks_costWork'][tr_math.id]['11'] = eval(tr_math.childNodes[11].innerText.replace(',','.'))

            if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1)
            {
                tr_math.childNodes[25].innerText = Number(tr_math.childNodes[11].innerText.replace(',','.')).toFixed(2);
            }
            }


        if (!isNaN(tr_math.childNodes[9].innerText.replace(',','.')) && tr_math.childNodes[9].innerText != '' ){
        tr_math.childNodes[13].innerText = (Number(tr_math.childNodes[9].innerText.replace(',','.')) * Number(tr_math.childNodes[11].innerText.replace(',','.'))).toFixed(2)

                if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1)
                    tr_math.childNodes[27].innerText = (Number(tr_math.childNodes[23].innerText.replace(',','.')) * Number(tr_math.childNodes[25].innerText.replace(',','.'))).toFixed(2)

        }
    } else {
        tr_math.childNodes[13].innerText = '';
        tr_math.childNodes[11].setAttribute('data-title' , "Введите корректное значение");
        PTO_td_sum(tr_math);
    }

    if(tr_math.childNodes[13].innerText != ''){
    PTO_td_sum(tr_math);
    }
});


formulaTable(tr_math.childNodes[15])

tr_math.childNodes[15].addEventListener('focusout', function(event) {

    tr_math.childNodes[15].removeAttribute('data-title');

    if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1 && tr_math.childNodes[15].innerText!=''){
        if (tr_math.childNodes[13].innerText != ''){
            if (!isNaN(tr_math.childNodes[15].innerText.replace(',','.')) && tr_math.childNodes[15].innerText != ''){
            tr_math.childNodes[29].innerText = Number(tr_math.childNodes[15].innerText.replace(',','.')).toFixed(2);
                tr_math.childNodes[17].innerText = (Number(tr_math.childNodes[13].innerText.replace(',','.')) / Number(tr_math.childNodes[15].innerText.replace(',','.'))).toFixed(2)
                tr_math.childNodes[31].innerText = (Number(tr_math.childNodes[13].innerText.replace(',','.')) / Number(tr_math.childNodes[15].innerText.replace(',','.'))).toFixed(2)
                PTO_td_sum(tr_math);
                } else {
                    tr_math.childNodes[15].setAttribute('data-title' , "Введите корректное значение");
                    tr_math.childNodes[17].innerText = Number(0);
                    PTO_td_sum(tr_math);
                }
        } else {
            tr_math.childNodes[29].innerText = Number(tr_math.childNodes[15].innerText.replace(',','.')).toFixed(2)
        }
    } else if(tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1){
                if (!isNaN(tr_math.childNodes[9].innerText.replaceAll(',','.')) && tr_math.childNodes[9].innerText!=''){
                if (!isNaN(tr_math.childNodes[15].innerText.replaceAll(',','.')) && tr_math.childNodes[15].innerText!=''){

                        tr_math.childNodes[9].innerText = Number(eval((tr_math.childNodes[15]).abbr.replaceAll(',','.')) * Number(eval(tr_math.childNodes[9].abbr.replaceAll(',','.')))).toFixed(2);
                        PTO_td_sum(tr_math);

                    } else {
                        tr_math.childNodes[9].innerText = (Number(eval(tr_math.childNodes[9].abbr.replaceAll(',','.')))*1).toFixed(2)
                        PTO_td_sum(tr_math);
                    }

                     if (!isNaN(tr_math.childNodes[11].innerText.replace(',','.')) && tr_math.childNodes[11].innerText!=''){
                    tr_math.childNodes[13].innerText = ((Number(tr_math.childNodes[9].innerText.replaceAll(',','.')) * Number(tr_math.childNodes[11].innerText.replaceAll(',','.')))).toFixed(2)
                    PTO_td_sum(tr_math);
                }
                }

            }
});
if (tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1) {
    formulaTable(tr_math.childNodes[19])
}

tr_math.childNodes[23].addEventListener('keyup', function(event) {

if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1){
tr_math.childNodes[23].removeAttribute('data-title')
 if (!isNaN(tr_math.childNodes[23].innerText.replace(',','.')) && tr_math.childNodes[23].innerText != ''){
            if (!isNaN(tr_math.childNodes[25].innerText.replace(',','.')) && tr_math.childNodes[25].innerText != ''){
            tr_math.childNodes[27].innerText = ((Number(tr_math.childNodes[23].innerText.replace(',','.')) * Number(tr_math.childNodes[25].innerText.replace(',','.')))).toFixed(2)
        }
} else {tr_math.childNodes[27].innerText = '';
        tr_math.childNodes[23].setAttribute('data-title' , "Введите корректное значение");
        Director_td_sum(tr_math);};
if(tr_math.childNodes[27].innerText != ''){
    Director_td_sum(tr_math);
}
}
});


tr_math.childNodes[25].addEventListener('keyup', function(event) {
tr_math.childNodes[25].removeAttribute('data-title')
if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1){
    if (!isNaN(tr_math.childNodes[25].innerText.replace(',','.')) &&   tr_math.childNodes[25].innerText != '' ){

        if (!isNaN(tr_math.childNodes[23].innerText.replace(',','.')) && tr_math.childNodes[23].innerText != '' ){
        tr_math.childNodes[27].innerText = (Number(tr_math.childNodes[23].innerText.replace(',','.')) * Number(tr_math.childNodes[25].innerText.replace(',','.'))).toFixed(2)

        }
    } else {
        tr_math.childNodes[27].innerText = '';
        tr_math.childNodes[25].setAttribute('data-title' , "Введите корректное значение")
        Director_td_sum(tr_math);
    }
    if(tr_math.childNodes[27].innerText != ''){
        Director_td_sum(tr_math);
    }
}
});


tr_math.childNodes[29].addEventListener('keyup', function(event) {
tr_math.childNodes[29].removeAttribute('data-title');

    if (tr_math.parentElement.id.indexOf('earthWorks_costWork')!=-1 && tr_math.childNodes[29].innerText!=''){
        if (tr_math.childNodes[27].innerText != ''){
            if (!isNaN(tr_math.childNodes[29].innerText.replace(',','.')) && tr_math.childNodes[29].innerText != ''){
                tr_math.childNodes[31].innerText = (Number(tr_math.childNodes[27].innerText.replace(',','.')) / Number(tr_math.childNodes[29].innerText.replace(',','.'))).toFixed(2)
                Director_td_sum(tr_math);
                } else {
                    tr_math.childNodes[29].setAttribute('data-title' , "Введите корректное значение");
                    tr_math.childNodes[31].innerText = Number(0);
                    Director_td_sum(tr_math);
                }
        }
    }
});


tr_math.childNodes[17].addEventListener('keyup', function(event) {
tr_math.childNodes[17].removeAttribute('data-title');
    if (tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1){

        if (!isNaN(tr_math.childNodes[17].innerText.replace(',','.')) && tr_math.childNodes[17].innerText != '' ){
                if (tr_math.childNodes[23].innerText!='' && !isNaN(Number(tr_math.childNodes[23].innerText.replace(',','.')))){
                    tr_math.childNodes[25].innerText = (Number(tr_math.childNodes[23].innerText.replace(',','.')) - Number(tr_math.childNodes[17].innerText.replace(',','.'))).toFixed(2);
                }
        }   else if (tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1){
                        tr_math.childNodes[17].setAttribute('data-title' , "Введите корректное значение");
                        tr_math.childNodes[25].innerText = Number(0);
                       }
     }
})


tr_math.childNodes[23].addEventListener('keyup', function(event) {
    if (tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1 && tr_math.childNodes[23].innerText!='' && !isNaN(Number(tr_math.childNodes[23].innerText.replace(',','.')))){
        tr_math.childNodes[23].removeAttribute('data-title');
        if (tr_math.childNodes[17].innerText!='' && !isNaN(Number(tr_math.childNodes[17].innerText.replace(',','.')))){
        {#console.log(tr_math.childNodes[23].innerText + ' - ' + tr_math.childNodes[17].innerText)#}
            tr_math.childNodes[25].innerText = (Number(tr_math.childNodes[23].innerText.replace(',','.')) - Number(tr_math.childNodes[17].innerText.replace(',','.'))).toFixed(2)
        }
    } else if (tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1){
    tr_math.childNodes[23].setAttribute('data-title' , "Введите корректное значение");
    tr_math.childNodes[25].innerText = Number(0);
    }
});


tr_math.childNodes[27].addEventListener('keyup', function(event){

if (tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1){
tr_math.childNodes[27].removeAttribute('data-title');
    if (!isNaN(tr_math.childNodes[27].innerText.replace(',','.')) && tr_math.childNodes[27].innerText != '' ){
            if (!isNaN(tr_math.childNodes[29].innerText.replace(',','.')) && tr_math.childNodes[29].innerText != '' ){
            tr_math.childNodes[31].innerText = (Number(tr_math.childNodes[27].innerText.replace(',','.')) * Number(tr_math.childNodes[29].innerText.replace(',','.'))).toFixed(2)
            Provision_td_sum(tr_math);
        }
    } else {
        tr_math.childNodes[31].innerText = '';
        Provision_td_sum(tr_math);
        tr_math.childNodes[27].setAttribute('data-title' , "Введите корректное значение");
        }
}
});
tr_math.childNodes[29].addEventListener('keyup', function(event){
if (tr_math.parentElement.id.indexOf('earthWorks_costMaterial')!=-1){
tr_math.childNodes[29].removeAttribute('data-title');
    if (!isNaN(tr_math.childNodes[29].innerText.replace(',','.')) && tr_math.childNodes[29].innerText != '' ){
            if (!isNaN(tr_math.childNodes[27].innerText.replace(',','.')) && tr_math.childNodes[27].innerText != '' ){
            tr_math.childNodes[31].innerText = (Number(tr_math.childNodes[27].innerText.replace(',','.')) * Number(tr_math.childNodes[29].innerText.replace(',','.'))).toFixed(2)
            Provision_td_sum(tr_math);
        }
    } else {
        tr_math.childNodes[31].innerText = '';
        tr_math.childNodes[29].setAttribute('data-title' , "Введите корректное значение");
        Provision_td_sum(tr_math);
        }
}
});

let all_td_in_stroka = $(`#${tr_math.id} td`)
let arr_key = ['Tab','Shift','Enter']
console.log('alert')
console.log(all_td_in_stroka)
let notEmpty = false
    for(let j in all_td_in_stroka){
        if(!isNaN(j)){
        {#console.log(j)#}

            all_td_in_stroka[j].addEventListener('keyup', function(event) {
            if (arr_key.indexOf(event.key)==-1){
            if (all_td_in_stroka[j].classList.length>0){
                for (let i=0; i<all_td_in_stroka[j].classList.length; i++){
                    if (all_td_in_stroka[j].classList[i].indexOf('editor')!=-1){
                        all_td_in_stroka[j].classList.remove(all_td_in_stroka[j].classList[i])
                        notEmpty = true
                    }
                }
            }
            if (notEmpty){
                all_td_in_stroka[j].classList.add(`editor_${(JSON.parse({{roles_user|tojson|safe}} )[0])}`);
            } else if ((JSON.parse({{roles_user|tojson|safe}} )[0])!='ENGINEER'){
                if (all_td_in_stroka[j].innerText!=''){
                all_td_in_stroka[j].classList.add(`editor_${(JSON.parse({{roles_user|tojson|safe}} )[0])}`);
                }
            }


            //editor_ADMIN  editor_ENGINEER  editor_MAIN_ENGINEER   editor_BOSS   editor_SUPPLIER
            console.warn(all_td_in_stroka[j])
            console.warn('alert')
            console.warn('roles = ', (JSON.parse({{roles_user|tojson|safe}} )[0]))
            }
            })
        }

    }
    console.log('ggg')
    let all_input = $("input[id ^='input_']")
        for(let j in all_input){
            if(!isNaN(j)) {
                console.log(j)
                console.log(all_input[j])
                all_input[j].addEventListener('change', function(event) {

                     if (all_input[j].classList.length>0){
                            for (let i=0; i<all_input[j].classList.length; i++){
                                        if (all_input[j].classList[i].indexOf('editor')!=-1){
                                            all_input[j].classList.remove(all_input[j].classList[i])
                                            notEmpty = true
                                        }
                            }
                     }
                     if (notEmpty){
                            all_input[j].classList.add(`editor_${(JSON.parse({{roles_user|tojson|safe}} )[0])}`);
                        } else if ((JSON.parse({{roles_user|tojson|safe}} )[0])!='ENGINEER'){
                            all_input[j].classList.add(`editor_${(JSON.parse({{roles_user|tojson|safe}} )[0])}`);
                        }


                })

            }
        }


}



function set_options_datalist(customer_id, search,id_datalist, count = 20) {
    $.ajax({
        method: 'POST',
        url: "/suggest/getSuggest",
        headers: {
            Accept: 'application/json',
            'Content-Type': 'application/json',
            "Authorization": getCookieValue("Authorization")
        },
        data: `{"customer_id":"${customer_id}","search": "${search}","count":${count}}`,
        success: function (ingredients) {
        console.log("success")

            for (var i in ingredients) {

                {#console.log("search",search)#}
                {#console.log("ingredients[i].value_table",ingredients[i].value_table)#}

                if (ingredients[i].value_table == search) {
                {#console.log("return")#}

                    return
                }
            }
                {#console.log("return2")#}

            $(`#${id_datalist}`).empty();
            for (var i in ingredients) {
                $(`<option id="${i}" />`).html(ingredients[i].value_table).appendTo(`#${id_datalist}`);
                if (i == ingredients.length - 1) {
                    $(`<option/>`).html(`Добавить в список "${search}"`).appendTo(`#${id_datalist}`);
                }

            }
        },
        error: function (error) {
            $(`#${id_datalist}`).empty();
            $(`<option/>`).html(`Добавить в список "${search}"`).appendTo(`#${id_datalist}`);

        },
    });
}

function set_setSuggest(customer_id, add_value,id_datalist) {
    $.ajax({
        method: 'POST',
        url: "/suggest/setSuggest",
        headers: {
            Accept: 'application/json',
            'Content-Type': 'application/json',
            "Authorization": getCookieValue("Authorization")
        },
        data: `{"customer_id":"${customer_id}","value_table": "${add_value}"}`,
        success: function (ingredients) {
            $(`#${id_datalist}`).empty();
    console.log("2set_options_datalist ", id_datalist)
            if (id_datalist.indexOf("_")!=-1){
            console.log('IF ',id_datalist)
            set_options_datalist(id_datalist.slice(id_datalist.indexOf('_')+1,id_datalist.lastIndexOf('_')),add_value,id_datalist,30)

            } else
                {
            set_options_datalist(id_datalist,add_value,id_datalist,30)

                }

        },
        error: function (error) {
        },
    });
}


let arr_zaglav = [];

document.getElementById('add_razdel').onclick = function () {
    if (JSON.parse({{roles_user|tojson|safe}} )[0] == 'SUPPLIER'){
        return
    }

    etalon_table = false;
    upTableTime();
        if (coll_table<=seach_ID_table('tbody','earthWorks_')) {
        coll_table = seach_ID_table('tbody','earthWorks_')+1;
        }

{#$("#style_table").style.display = 'block';#}
let e = document.getElementById("select_one");
let value = e.value;

 if(value == ''){
            e.setAttribute("required", true)
       } else if (arr_zaglav.indexOf(value) == -1){
        arr_zaglav.push(value)
        {#console.log(arr_zaglav)#}
        document.getElementById("style_table").style.display = "block";
        if (document.getElementById('result_total')) document.getElementById('result_total').remove()
        obj_global_sum['earthWorks_costWork_'+ coll_table] = "";
        obj_global_sum['earthWorks_costMaterial_'+ coll_table] = "";
        obj_global_sum['earthWorks_Special_'+ coll_table] = "";
        obj_global_sum['earthWorks_Total_'+ coll_table] = "";
        obj_global_sum['Total_tbody_'+ coll_table] = "";
        obj_global_sum['Вспомогательные_материалы_'+ coll_table] = "6";
        obj_global_sum['Накладные_расходы_'+ coll_table] = "120";
        obj_global_sum['Транспортные_расходы_'+ coll_table] = "10";


        $("#first_table").append(`<tbody id = "earthWorks_${coll_table}">
                    <tr><td colspan="6" style="padding: 0; height: 1px; height: -moz-available;"><input id = 'zagolovok_${coll_table}' style = "width: 100%; height: 100%; border:  0;" autocomplete="off">
                               </td><td colspan="4" class="tehstolbec but_del_razdel"><button id='del_razdel_${coll_table}' type="button" class="btn-primary"> Удалить раздел</button></td>
                    </tr>
                        <tr style="background-color: #fce1b3">
                            <td rowspan="2"  class="tehstolbec">Тех столбец</td>
                            <td>№</td>
                            <td rowspan="2" style="font-weight: bold;">Наименование</td>
                            <td colspan="4" style="font-weight: bold;">Стоимость</td>
                            <td colspan="4" style="font-weight: bold;">Справочная информация</td>
                            <td colspan="8" style="font-weight: bold; display:none" class="pto">Аналитический блок</td>
                        </tr>

                        <tr style="background-color: #fce1b3">
                            <td style="font-weight: bold;">п/п</td>
                            <td style="font-weight: bold;">Ед.изм.</td>
                            <td style="font-weight: bold;">Кол-во</td>
                            <td style="font-weight: bold;">Цена</td>
                            <td style="font-weight: bold;">Всего</td>
                            <td rowspan="1" style="font-weight: bold;">Тр-затр (чел-дн)</td>
                            <td rowspan="1" style="font-weight: bold;">Столбец для анализа</td>
                            <td rowspan="1" style="font-weight: bold;"></td>
                            <td rowspan="1" style="font-weight: bold;">Примечание</td>
                            <td style="font-weight: bold; display:none" class="pto">Кол-во</td>
                            <td style="font-weight: bold; display:none" class="pto">Цена руб-ед</td>
                            <td style="font-weight: bold; display:none" class="pto">Всего</td>
                            <td style="font-weight: bold; display:none" class="pto">Тр-затр (чел-дн)</td>
                            <td style="font-weight: bold; display:none" class="pto">Стоимость дня рабочего</td>
                        </tr>
                        </tbody>
                        <tbody id = 'earthWorks_costWork_${coll_table}'>
                        <tr>
                            <td class="tehstolbec"><button id="button_costWork_collapse_${coll_table}" type="button" onclick="collaps_tbody('costWork', ${coll_table}, this)">Свернуть</button></td>
                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>
                            <td contenteditable="false" id = 'earthWorks_costWork_addLine_${coll_table}' style="font-weight: bold; border-left: none;" colspan="4" onmouseover="showButton(event, this)" onmouseout="closeButton(event,this)">
                            Стоимость работ
                            <div style = "display:none"><button type="button" onclick="addLine(event,this)">addLine</button></div>
                            </td>
                            <td contenteditable="false"></td>


                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto"></td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto"></td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto"></td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto"></td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto"></td>
                        </tr>
                    <tbody id = 'earthWorks_costMaterial_${coll_table}'>
                        <tr>
                        <td class="tehstolbec"><button id="button_costMaterial_collapse_${coll_table}" type="button" onclick="collaps_tbody('costMaterial', ${coll_table}, this)">Свернуть</button></td>
                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>
                            <td contenteditable="false" id = 'earthWorks_costMaterial_addLine_${coll_table}' style="font-weight: bold; border-left: none;" colspan="4" onmouseover="showButton(event, this)" onmouseout="closeButton(event,this)">
                            Стоимость материала
                            <div style = "display:none"><button  onclick="addLine(event,this)">addLine</button></div>
                            </td>
                            <td contenteditable="false"></td>


                            <td contenteditable="false" colspan="2" style="font-weight: bold;"> Ед изм расчётные </td>

                            <td contenteditable="false" style="font-weight: bold;"> Ед изм (М2) для окраски </td>

                            <td contenteditable="false"></td>

                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Закупка по счету - ед изм расчётные</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Остаток закупки</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">ед изм к закупке</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">руб-ед</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto"></td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Счёта</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Срок поставки</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">ПРИМЕЧАНИЕ</td>
                        </tr>
                    </tbody>

                    <tbody id = 'earthWorks_Special_${coll_table}'>
                    <tr>
                    <td class="tehstolbec"><button id="button_Special_collapse_${coll_table}" type="button" onclick="collaps_tbody('Special', ${coll_table}, this)">Свернуть</button></td>
                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>
                             <td contenteditable="false" id = 'earthWorks_Special_addLine_${coll_table}' style="font-weight: bold; border-left: none;" colspan="4" onmouseover="showButton(event, this)" onmouseout="closeButton(event,this)">
                            Стоимость спецтехники
                            <div style = "display:none"><button  onclick="addLine(event,this)">addLine</button></div>
                            </td>
                            <td contenteditable="false"></td>


                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>

                            <td contenteditable="false"></td>

                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Стоимость аренды</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Телефон</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Счет</td>
                            <td contenteditable="false" style="font-weight: bold; display:none" class="pto">Срок</td>

                        </tr>

                    </tbody>

                     <tbody id = 'earthWorks_Total_${coll_table}'>
                        <tr>
                        <td style="border-right: none;" class="tehstolbec"></td>
                            <td contenteditable="false" style="border-left: none; border-right: none;"></td>
                            <td contenteditable="false" style="font-weight: bold;border-left: none;" colspan="4"> Итого
                            </td>


                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="display:none" class="pto"></td>
                            <td contenteditable="false" style="display:none" class="pto"></td>
                            <td contenteditable="false" style="display:none" class="pto"></td>
                            <td contenteditable="false" style="display:none" class="pto"></td>


                        </tr>
                        <tr id = "stroka">
                        <td  class="tehstolbec" ></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold;">
                                Накладные расходы
                            </td>
                            <td contenteditable="false">%</td>
                            <td contenteditable="true" class="percent">120</td>
                            <td contenteditable="true"></td>

                            <td contenteditable="false"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>


                        </tr>

                        <tr id = "stroka">
                        <td  class="tehstolbec"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold;">
                                Вспомогательные материалы
                            </td>
                            <td contenteditable="false">%</td>
                            <td contenteditable="true" class="percent">6</td>
                            <td contenteditable="true"></td>



                            <td contenteditable="false"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"</td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>


                        </tr>

                        <tr id = "stroka">
                        <td  class="tehstolbec"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold;">
                                Транспортные расходы
                            </td>
                            <td contenteditable="false">%</td>
                            <td contenteditable="true" class="percent">10</td>
                            <td contenteditable="true"></td>



                            <td contenteditable="false"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>
                            <td contenteditable="true" style="display:none" class="costWork_role_boss pto"></td>


                        </tr>

                        <tr id = "stroka">
                        <td class="tehstolbec"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold; text-align: right">
                                ВСЕГО:
                            </td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>



                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>

                        </tr>
                        <tr id = "stroka">
                        <td class="tehstolbec"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold;">
                                В том числе НДС - 20% за нал от материалов
                            </td>
                            <td contenteditable="false">%</td>
                            <td contenteditable="true" class="percent">20</td>
                            <td contenteditable="true"></td>


                            <td contenteditable="false"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>
                            <td contenteditable="true"></td>

                        </tr>
                    </tbody>

                    <tbody id = 'result_total'>
                    <tr class="blank_row">

                    </tr>
                        <tr>
                        <td class="tehstolbec"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold; text-align: right">
                                Итого по разделам:
                            </td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>

                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                        </tr>
                        <tr>
                        <td class="tehstolbec"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false" style="font-weight: bold;">
                               Итого НДС:
                               </td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>

                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                            <td contenteditable="false"></td>
                        </tr>
                    </tbody>
                    `)
                    if (JSON.parse({{roles_user|tojson|safe}} )[0] != 'ENGINEER'){
                    $('.pto').css("display", "table-cells");
                        //table_html.replaceAll('display:none','display:table-cells');
                    }
{#<tr class="blank_row">#}
{#<td colspan="100%"></td>#}
{#                    </tr>#}


                    document.getElementById(`zagolovok_${coll_table}`).setAttribute('value', value);
                    document.getElementById("saveTable").style.display = "block";
                    document.getElementById("panel_1").style.display = "block";
                    document.getElementById("panel_2").style.display = "block";
                    document.getElementById("saveTable_description").style.display = "block";
                    document.getElementById("saveTable_description_label").style.display = "block";
                    document.getElementById("versionTable_label").style.display = "block";
                    document.getElementById("Otpravka_roles_label").style.display = "block";
                    document.getElementById("Otpravka_roles").style.display = "block";
                    document.getElementById("versionTable").style.display = "block";
                    document.getElementById("Otpravka_roles_button").style.display = "block";
                    document.getElementById("Otpravka_roles_label_comment").style.display = "block";
                    document.getElementById("Otpravka_roles_text").style.display = "block";
                    table_earthWorks_Total(coll_table)






  document.getElementById(`del_razdel_${coll_table}`).onclick = function (event){del_func (event)}



        coll_table++;
        arr_coll_table.push(coll_table);
        {#console.warn('counterTr(); из add_razdel')#}
        counterTr();
        }
            else {
            showToast('Заголовок есть' , 'warning' , 5000)
            }
                let maskTable = $('.maska')
                if ($('*[id^=earthWorks_]').length != 0){
                if (maskTable.length == 0){
                    $('*[id^=earthWorks_]')[0].classList.add('maska');
                } else {
                    maskTable[0].classList.remove("maska")
                    //$('.maska')[0].classList.remove('maska')
                    $('*[id^=earthWorks_]')[0].classList.add('maska');
                }
                }
            resize_div_for_table()

        }

function table_earthWorks_Total(coll_table){
document.getElementById('earthWorks_Total_'+coll_table).childNodes[3].childNodes[9].addEventListener('keyup', function(event){
    this.removeAttribute('data-title')
    let id_table = this.parentElement.parentElement.id.slice(this.parentElement.parentElement.id.lastIndexOf('_')+1)

        if (!isNaN(this.innerText.replace(',','.').replace('%','')) && this.innerText != ''){
obj_global_sum['Накладные_расходы_' +  id_table] = this.innerText.replace(',','.').replace('%','');
    if (obj_global_sum['earthWorks_costWork_'+id_table] != ''){
    {#console.log('popal')#}
        this.parentElement.parentElement.childNodes[3].childNodes[13].innerText = ((this.innerText.replace(',','.').replace('%',''))/100 * obj_global_sum['earthWorks_costWork_'+id_table]).toFixed(2)
        func_sum_vsego_razdel(this);
    }
} else {
        this.setAttribute('data-title' , "Введите корректное значение");
        this.parentElement.parentElement.childNodes[3].childNodes[13].innerText = '';
        obj_global_sum['Накладные_расходы_'+id_table]='';
        func_sum_vsego_razdel(this);
        }

});


document.getElementById('earthWorks_Total_'+coll_table).childNodes[5].childNodes[9].addEventListener('keyup', function(event){
    this.removeAttribute('data-title')
    let id_table = this.parentElement.parentElement.id.slice(this.parentElement.parentElement.id.lastIndexOf('_')+1)
        if (!isNaN(this.innerText.replace(',','.').replace('%','')) && this.innerText != ''){
        obj_global_sum['Вспомогательные_материалы_' +  id_table] = this.innerText.replace(',','.').replace('%','')
    if (obj_global_sum['earthWorks_costMaterial_'+id_table] != ''){
    {#console.log('popal')#}
        this.parentElement.parentElement.childNodes[5].childNodes[13].innerText = ((this.innerText.replace(',','.').replace('%',''))/100 * obj_global_sum['earthWorks_costMaterial_'+id_table]).toFixed(2)
        func_sum_vsego_razdel(this);
    }
} else {
        this.setAttribute('data-title' , "Введите корректное значение");
        this.parentElement.parentElement.childNodes[5].childNodes[13].innerText = '';
        obj_global_sum['Вспомогательные_материалы_'+id_table]=''
        func_sum_vsego_razdel(this);
        };
});
document.getElementById('earthWorks_Total_'+coll_table).childNodes[7].childNodes[9].addEventListener('keyup', function(event){
    this.removeAttribute('data-title')
    let id_table = this.parentElement.parentElement.id.slice(this.parentElement.parentElement.id.lastIndexOf('_')+1)
        if (!isNaN(this.innerText.replace(',','.').replace('%','')) && this.innerText != ''){
obj_global_sum['Транспортные_расходы_' +  id_table] = this.innerText.replace(',','.').replace('%','')
    if (obj_global_sum['earthWorks_costMaterial_'+id_table] != ''){
    {#console.log('popal')#}
        this.parentElement.parentElement.childNodes[7].childNodes[13].innerText = ((this.innerText.replace(',','.').replace('%',''))/100 * obj_global_sum['earthWorks_costMaterial_'+id_table]).toFixed(2)
        func_sum_vsego_razdel(this);
    }
} else {
        this.setAttribute('data-title' , "Введите корректное значение");
        this.parentElement.parentElement.childNodes[7].childNodes[13].innerText = '';
        obj_global_sum['Транспортные_расходы_'+id_table]='';
        func_sum_vsego_razdel(this);
        };
});

document.getElementById('earthWorks_Total_'+coll_table).childNodes[11].childNodes[9].addEventListener('keyup', function(event){
    this.removeAttribute('data-title')
    let id_table = this.parentElement.parentElement.id.slice(this.parentElement.parentElement.id.lastIndexOf('_')+1)
        if (!isNaN(this.innerText.replace(',','.').replace('%','')) && this.innerText != ''){

    if (obj_global_sum['ВСЕГО_'+id_table] != '' && Object.keys(obj_global_sum).indexOf('ВСЕГО_'+id_table)!=-1){
    {#console.log('popal')#}
        this.parentElement.parentElement.childNodes[11].childNodes[13].innerText = (obj_global_sum['ВСЕГО_'+id_table] * (this.innerText.replace(',','.').replace('%',''))/(100+Number(this.innerText.replace(',','.').replace('%','')))).toFixed(2)
        {#this.parentElement.parentElement.childNodes[11].childNodes[13].innerText = (obj_global_sum['ВСЕГО_'+id_table] * (Number(this.innerText.replace(',','.').replace('%','') )/(100+Number(this.innerText.replace(',','.').replace('%','')))).toFixed(2)#}
        obj_global_sum['ВСЕГО_НДС_'+id_table]=this.parentElement.parentElement.childNodes[11].childNodes[13].innerText;
        func_sum_vsego_razdel(this);
        pereschetTotalNDS()
    }
} else {
        this.setAttribute('data-title' , "Введите корректное значение");
        this.parentElement.parentElement.childNodes[11].childNodes[13].innerText = '';
        obj_global_sum['ВСЕГО_НДС_'+id_table]='';
        func_sum_vsego_razdel(this);
        pereschetTotalNDS();
        }
})  ;

}

 function counterTr(){
 console.warn('counterTr')
 console.log('arr_coll_table = ',arr_coll_table)
let arr_tbody = [];
let arr_tr = [];
let last_index = 0;
let razdelov = 0;

                $(`#first_table tbody`).each(function () {
                    arr_tbody.push(this.id);
                });
                if (arr_tbody.length >= 5){
          razdelov = arr_tbody.length / 5;
          console.warn('razdelov v tablice = ', razdelov)
          {#console.warn('arr_tbody = ', arr_tbody)#}
          }
                {# собрать все цифры после '_' в массив и подствить в for 'J'#}
                {#console.warn('arr_tbody = ' , arr_tbody,' arr_tbody.length = ' , arr_tbody.length);#}
for(let j = 1; j <= razdelov; j++){
console.log('j=',j)

{#arr_tr = [];#}
for (let i of arr_tbody){
{#console.log(arr_tbody)#}
{#console.log('i=',i)#}
arr_tr = [];
    if (i.slice(0, i.lastIndexOf('_')) != 'earthWorks'){
    console.log('first if ', i, ' || ', i.slice(i.lastIndexOf('_')+1, i.length))

        {#if(i.slice(i.lastIndexOf('_')+1, i.length) == arr_coll_table[j-1]){#}
        console.log('for if   ', i.slice(i.lastIndexOf('_')+1, i.length))
            $(`#${i} tr`).each(function () {
            {#console.log(i, '=i    arr_tr=',arr_tr)#}
            {# if убрать, если нужно пронумеровать все строки#}
            if (this.id.indexOf('stroka')!=-1){
                    {#this.firstElementChild.innerHTML = arr_tr.length + 1;#}
                    this.childNodes[3].innerHTML = arr_tr.length + 1;
                    {#console.log(this.childNodes[3])#}
                    console.log(arr_tr.length + 1)
                    arr_tr.push(this.parentElement.id.slice(this.parentElement.id.lastIndexOf('_')+1));
                    }
            });
          {#console.log('arr_tr = ' + arr_tr)#}
        }

}
}

}

$(document).on('change', 'input', function () {
{#console.log(this.id)#}

if(this.id.indexOf('Form_') == -1){
        {#console.log(this)#}
        let val = $(this).val();
        {#console.warn(val);#}
        {#console.warn($(this)[0].list.id);#}
        $(this)[0].setAttribute('value', val); {# добавляется атрибут value в изменяемый input#}
        {#let options_id = $(this)[0].list.id
        let options = $(`datalist#${options_id}`)[0].options;
        console.warn(options);#}
}
  });

    table.addEventListener('click', function handleClick(event) {
        if (event.target.type == 'button' && (event.target.id.slice(0,event.target.id.lastIndexOf('_')) == 'button_table_2' || event.target.id.slice(0,event.target.id.lastIndexOf('_')) == 'button_table_1')){
            let str = event.target.id.slice(event.target.id.lastIndexOf('_')+1, event.target.id.length);
            addLineString(str, event.target.id, id_count);
            id_count++;
            arr_id_count.push(id_count);
        } else if (event.target.type == 'button' && event.target.id.slice(0,event.target.id.lastIndexOf('_')) == 'delbtn'){
        {#console.warn('tyt', event.target.id)#}
        if (JSON.parse({{roles_user|tojson|safe}} )[0]!= 'SUPPLIER'){
            delLine(event.target.id);
            }
        }

        /*
        else if (event.target.type == 'button' && event.target.id.slice(0,event.target.id.lastIndexOf('_')) == 'addbtn'){
           console.log('click')
           if (JSON.parse({{roles_user|tojson|safe}} )[0]!= 'SUPPLIER'){
               addBetweenLine(event.target.id);
           }

        }
        */

});



    function delLine(cel){
        etalon_table = false;
        upTableTime();
        {#console.warn('cel= ' + cel)#}
        let id_table = document.getElementById(cel).parentElement.parentElement.parentElement.id;
        id_table = id_table.slice(id_table.lastIndexOf('_')+1,id_table.length)
        {#console.log('tbody = ' + id_table)#}
        let id_del = cel.slice(cel.lastIndexOf('_')+1, cel.length)
        {#console.warn('id_del !!! ' , id_del)#}

        {#console.warn(document.getElementById('stroka_' + id_del).parentElement.id)#}

        let del_math_td = document.getElementById('stroka_' + id_del);

        if(!isNaN(del_math_td.parentElement.childNodes[1].childNodes[7].innerText)  && !isNaN(del_math_td.childNodes[13].innerText) {#&& !isNaN(del_math_td.parentElement.childNodes[1].childNodes[9].innerText)#}){

            del_math_td.parentElement.childNodes[1].childNodes[7].innerText = (Number(del_math_td.parentElement.childNodes[1].childNodes[7].innerText) - Number(del_math_td.childNodes[13].innerText)).toFixed(2)
            {#console.log('!!! ', del_math_td.parentElement.childNodes[1].childNodes[7].innerText)#}
            obj_global_sum[document.getElementById('stroka_' + id_del).parentElement.id] = del_math_td.parentElement.childNodes[1].childNodes[7].innerText;
            let index = del_math_td.parentElement.id.slice(del_math_td.parentElement.id.lastIndexOf('_')+1);
            obj_global_sum['earthWorks_Total_' + index] = Number(obj_global_sum['earthWorks_costWork_' + index]) + Number(obj_global_sum['earthWorks_costMaterial_' + index]) + Number(obj_global_sum['earthWorks_Special_' + index])
            {#console.warn(document.getElementById('earthWorks_Total_'+ index).childNodes[1].childNodes[7].innerText)#}
            document.getElementById('earthWorks_Total_'+ index).childNodes[1].childNodes[7].innerText = Number(obj_global_sum['earthWorks_Total_' + index]).toFixed(2)
            //.childNodes[1].childNodes[7].innerText = Number(obj_global_sum['earthWorks_Total_' + index]).toFixed(2)

            // подсчет итоговых значений "Столбец для анализа" в "Стоимость работ"
            if (del_math_td.parentElement.id.indexOf('earthWorks_costWork')!=-1 ){

            if (del_math_td.parentElement.childNodes.length == 4 ){
                del_math_td.parentElement.childNodes[1].childNodes[11].innerText ='';
                del_math_td.parentElement.childNodes[1].childNodes[9].innerText ='';
                del_math_td.parentElement.childNodes[1].childNodes[25].innerText ='';
                del_math_td.parentElement.childNodes[1].childNodes[23].innerText ='';
                del_math_td.parentElement.childNodes[1].childNodes[21].innerText ='';

            } else {


                del_math_td.parentElement.childNodes[1].childNodes[21].innerText = (Number(del_math_td.parentElement.childNodes[1].childNodes[21].innerText) - Number(del_math_td.childNodes[27].innerText)).toFixed(2)

                if (!isNaN(del_math_td.parentElement.childNodes[1].childNodes[9].innerText)  && (Number(del_math_td.parentElement.childNodes[1].childNodes[9].innerText)- Number(del_math_td.childNodes[15].innerText))!=0) {
                del_math_td.parentElement.childNodes[1].childNodes[9].innerText = (Number(del_math_td.parentElement.childNodes[1].childNodes[9].innerText) - Number(del_math_td.childNodes[15].innerText)).toFixed(2)


                del_math_td.parentElement.childNodes[1].childNodes[11].innerText = (del_math_td.parentElement.childNodes[1].childNodes[7].innerText/del_math_td.parentElement.childNodes[1].childNodes[9].innerText).toFixed(2)

                } else {
                del_math_td.parentElement.childNodes[1].childNodes[11].innerText =''
                del_math_td.parentElement.childNodes[1].childNodes[9].innerText =''
                }
                if (!isNaN(del_math_td.parentElement.childNodes[1].childNodes[23].innerText) && (Number(del_math_td.parentElement.childNodes[1].childNodes[23].innerText)- Number(del_math_td.childNodes[29].innerText))!=0){
                del_math_td.parentElement.childNodes[1].childNodes[23].innerText = (Number(del_math_td.parentElement.childNodes[1].childNodes[23].innerText) - Number(del_math_td.childNodes[29].innerText)).toFixed(2)

                del_math_td.parentElement.childNodes[1].childNodes[25].innerText = (del_math_td.parentElement.childNodes[1].childNodes[21].innerText/del_math_td.parentElement.childNodes[1].childNodes[23].innerText).toFixed(2)
            {#  if на [25] если нет знаков после нулей, то убрать запятую  #}

                } else {
                del_math_td.parentElement.childNodes[1].childNodes[25].innerText =''
                del_math_td.parentElement.childNodes[1].childNodes[23].innerText =''
                }


            }

            }
        } else {
            del_math_td.parentElement.childNodes[1].childNodes[7].innerText = '';
            if (del_math_td.parentElement.id.indexOf('earthWorks_costWork')!=-1){
                del_math_td.parentElement.childNodes[1].childNodes[21].innerText = '';
                del_math_td.parentElement.childNodes[1].childNodes[9].innerText = '';
                del_math_td.parentElement.childNodes[1].childNodes[11].innerText = '';
                del_math_td.parentElement.childNodes[1].childNodes[23].innerText = '';
                del_math_td.parentElement.childNodes[1].childNodes[25].innerText = '';
            }
        }
        let idParelem = document.getElementById(`stroka_${id_del}`).parentElement.id;
        console.log('idParelem  ', idParelem)
        document.getElementById(`stroka_${id_del}`).remove()
                counterTr();

                if (idParelem.indexOf('earthWorks_costMaterial_')!= -1 && $(`#${idParelem} tr`).length == 1){
                    let temp = idParelem.slice(idParelem.lastIndexOf('_')+1);
                    console.log(temp)
                    obj_global_sum['ВСЕГО_НДС_'+temp]='';
                    $(`#earthWorks_Total_${temp}`)[0].childNodes[11].childNodes[13].innerText = Number(0).toFixed(2)
                } else if(idParelem.indexOf('earthWorks_costMaterial_')!= -1){
                        console.log('попал в есле и вызываю PTO')
                        PTO_td_sum($(`#${idParelem} tr`)[1]);
                }

                func_sum_vsego_razdel($(`#${idParelem} tr`)[0].childNodes[5]);
                pereschetTotalSum();
                pereschetTotalNDS();
                resize_div_for_table()

    }


{#<input id="select_one" type="text" list="ListRazdel" value="123" class="form-control" autocomplete="off">

<input id="input_costWork_5" type="text" list="datalist_costWork_5" value="12" style="width: 100%; height: 100%; border:  0; background: radial-gradient(farthest-corner at 50% 50%, white, #e5ebf2);" autocomplete="off">
#}
$("#div1").delegate(":input", "input", function (e) {
let forObj = 'ListRazdel'
    console.warn('!@#this div1: ', this)

let type = forObj;
let id_count=e.target.id;
{#console.log("stroka = " + " #datalist_" + forObj + "_"+id_count)#}
    var options = $(`#${forObj}`)[0].options;
    {#console.log("options = " + options)#}
    if (options.length != 0 && options[options.length - 1].value == $(this).val()) {
    {#console.log('tyt1')#}
        if ($(this).val().indexOf("Добавить в список \"") != -1) {
    {#console.log('forObj',forObj)#}

            set_setSuggest(type, $(this).val().replace("Добавить в список \"", "").slice(0, -1),forObj)
    {#console.log('1111111111111111111111')#}
    {#console.log('1111111111111111111111',$(this).val().replace("Добавить в список \"", "").slice(0, -1))#}


            $(`#select_one`).val($(this).val().replace("Добавить в список \"", "").slice(0, -1));
        }
        return
    }
    set_options_datalist(type, e.target.value, forObj, 30)

});


</script>